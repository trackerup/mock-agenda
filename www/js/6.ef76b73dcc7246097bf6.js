webpackJsonp([6],{Byen:function(t,e){},PYfp:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=s("//Fk"),a=s.n(n),r=s("Xxa5"),i=s.n(r),o=s("exGp"),c=s.n(o),u=s("Dd8w"),d=s.n(u),l=s("7+uW"),h=s("DYhV"),k=s("3uXF"),v=s("NYxO"),f=s("0xDb"),p=s("PqRL"),m=s("Q+0R"),g=s("4YyR"),b=s("poJr"),w=s("hvEy"),_=s("4zFs"),$=(s("mswI"),s("V25Q"),s("SGZ6"),s("UdET")),y={extends:$.a,name:"InputCheckboxes",props:{field:{type:Object,required:!0}}},x={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.readOnly?s("div",{staticClass:"readOnly"},[s("label",{staticClass:"orange"},[s("span",{domProps:{innerHTML:t._s(t.texto)}}),t._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:t.obrigatorio,expression:"obrigatorio"}]},[t._v("*")])]),t._v(" "),s("span",{staticClass:"value"},t._l(t.field.value,function(e,n){return s("span",{key:n},[t._v(t._s(e)),s("br")])}),0)]):s("div",{staticClass:"section-field"},[s("label",{staticClass:"orange"},[s("span",{domProps:{innerHTML:t._s(t.field.label)}}),t._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:t.obrigatorio,expression:"obrigatorio"}]},[t._v("*")])]),t._v(" "),t._l(t.field.vars.items,function(e,n){return s("label",{directives:[{name:"mdl",rawName:"v-mdl"}],key:n,staticClass:"mdl-checkbox mdl-js-checkbox "},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.field.value,expression:"field.value"}],staticClass:"mdl-checkbox__input",attrs:{type:"checkbox",id:e.name+e.id,name:e.name},domProps:{value:e.id,checked:Array.isArray(t.field.value)?t._i(t.field.value,e.id)>-1:t.field.value},on:{change:function(s){var n=t.field.value,a=s.target,r=!!a.checked;if(Array.isArray(n)){var i=e.id,o=t._i(n,i);a.checked?o<0&&t.$set(t.field,"value",n.concat([i])):o>-1&&t.$set(t.field,"value",n.slice(0,o).concat(n.slice(o+1)))}else t.$set(t.field,"value",r)}}}),t._v(" "),s("span",{staticClass:"mdl-checkbox__label"},[t._v(t._s(e.name))])])}),t._v(" "),t._l(t.errors,function(e,n){return s("span",{key:n,staticClass:"mdl-error",domProps:{innerHTML:t._s(e)}})})],2)])},staticRenderFns:[]};s("VU/8")(y,x,!1,function(t){s("n8T+")},"data-v-91888cdc",null).exports,s("9+hI"),s("xZ6D"),s("1gkJ"),s("M8gs"),s("Ic6h"),s("vyob"),s("EBc6"),s("H9AV"),s("9b+F"),s("aeih"),s("korG"),s("qZCB"),s("RzjH"),s("2/7y"),s("t+vX"),s("ZBP7"),s("F8oN"),s("Q2ZQ"),s("6sG6"),s("3KnT"),s("35fZ");var T={name:"Tasks",components:{HourSeparator:k.a,TaskItem:h.a,InputAccordingSimple:$.a},data:function(){return{tasksMorning:[],tasksEvening:[],tasksNight:[],tasksDawn:[],synchronizationTasks:null,synchronizationRoute:null,errorAproveRoute:!1,allowOrder:!0,orderName:"",fabActive:!1}},computed:d()({},Object(v.b)({tasks:"task/tasks",user:"user/user",viewDate:"task/viewDate",startBackground:"user/startBackground"}),{morning:function(){return{name:"morning",time:"07:00",period:this.$t("Manhã"),reorder:!1}},evening:function(){return{name:"evening",time:"13:00",period:this.$t("Tarde"),reorder:!1}},night:function(){return{name:"night",time:"19:00",period:this.$t("Noite"),reorder:!1}},dawn:function(){return{name:"dawn",time:"01:00",period:this.$t("Madrugada"),reorder:!1}}}),watch:{tasks:function(t){this.sortTasksByPeriod(),this.$bus.$emit("delete-old-tasks")}},created:function(){var t=this;return c()(i.a.mark(function e(){var s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=new Date,e.next=3,t.$store.dispatch("task/updateViewDate",{date:s});case 3:return e.next=5,t.$store.dispatch("task/getTasks",{});case 5:return e.next=7,t.$store.dispatch("task/setCurrentTask",{task:null});case 7:"true"==t.$store.getters["user/startBackground"]&&t.initRastreamento();case 9:case"end":return e.stop()}},e,t)}))()},beforeMount:function(){var t=l.default.extend(p.a);this.synchronizationTasks=new t;var e=l.default.extend(m.a);this.synchronizationRoute=new e},mounted:function(){var t=this;console.log(this.tasks),window.inSync=!1,this.synchronizationTasks.makeTasksSync(this,!1,!0).then(function(e){t.$bus.$emit("tasks-sync",!0)}).catch(function(){t.$bus.$emit("tasks-sync",!1)}),this.fabActive=!1,this.$emit("changeParams",{pageTitle:this.$t("OS em preparo"),mapMenu:!0,backMenu:!1}),this.$root.dialogOpen=!1,this.sortTasksByPeriod()},methods:{sortTasksByPeriod:function(){var t=this,e=this;if(this.tasksMorning=[],this.tasksEvening=[],this.tasksNight=[],this.tasksDawn=[],this.tasks.all){var s=this.viewDate,n=this.tasks.all.filter(function(t){return t.rota==e.user.route.id&&"concluida"!=t.status&&"malsucedida"!=t.status&&t.dataTarefa==s});n.sort(function(t,e){return t.urgente<e.urgente?-1:t.urgente>e.urgente?1:0}),n.forEach(function(e){var s=JSON.parse(e.planedStart).hora;s>=1&&s<=6?Object(f.b)(t.tasksDawn,e)||t.tasksDawn.push(e):s>=7&&s<=12?Object(f.b)(t.tasksMorning,e)||t.tasksMorning.push(e):s>=13&&s<=18?Object(f.b)(t.tasksEvening,e)||t.tasksEvening.push(e):s>=19&&s<=23&&(Object(f.b)(t.tasksNight,e)||t.tasksNight.push(e))})}},setDate:function(t){var e=this;return c()(i.a.mark(function s(){return i.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,e.$store.dispatch("task/updateViewDate",{date:t.target.value});case 2:return s.next=4,e.$store.dispatch("task/getTasks",{});case 4:e.$bus.$emit("tasks-sync",!0),e.sortTasksByPeriod();case 6:case"end":return s.stop()}},s,e)}))()},routeBlocked:function(){return!!(this.user&&this.user.route&&"1"==this.user.route.status&&this.tasks.bloqueada)},requestAproveRoute:function(){var t=this;t.timeoutAproveRoute=!0,t.errorAproveRoute=!1;var e="dialogLoaderRequestAproveRoute";try{this.$el.querySelector("#"+e).open?(this.$el.querySelector("#"+e).close(),this.$el.querySelector("#"+e).showModal()):this.$el.querySelector("#"+e).showModal()}catch(t){console.log("dialog error")}this.initRastreamento(),this.sincPreAproveRoute().finally(function(){try{t.$el.querySelector("#"+e).close(),t.timeoutAproveRoute=!1,t.fabActive=!1}catch(t){console.log("dialog error")}}),setTimeout(function(){t.timeoutAproveRoute&&(t.errorAproveRoute=!0)},6e4)},closeModal:function(){try{this.$el.querySelector("#dialogLoaderRequestAproveRoute").close()}catch(t){console.log("dialog error")}},initRastreamento:function(){var t=this;this.$bus.$emit("startBackground",!0),Object(_.b)(this.user).then(function(t){t.data;console.log("Inicio Rastreamento")}).catch(function(e){var s=e.data;t.error=t.$t(s.error);var n={message:t.$t(t.error)};t.$bus.$emit("showSnackBar",n)})},ordernarUrgencia:function(t){var e,s,n,a;switch(this.orderName){case"morning":e=this.tasksMorning.findIndex(function(e){return e.id==t.id}),a=this.tasksMorning[e],"up"==t.direction&&e>0&&(s=this.tasksMorning[e-1],this.$set(this.tasksMorning,e,s),this.$set(this.tasksMorning,e-1,a)),"down"==t.direction&&e<this.tasksMorning.length-1&&(n=this.tasksMorning[e+1],this.$set(this.tasksMorning,e,n),this.$set(this.tasksMorning,e+1,a));break;case"evening":e=this.tasksEvening.findIndex(function(e){return e.id==t.id}),a=this.tasksEvening[e],"up"==t.direction&&e>0&&(s=this.tasksEvening[e-1],this.$set(this.tasksEvening,e,s),this.$set(this.tasksEvening,e-1,a)),"down"==t.direction&&e<this.tasksEvening.length-1&&(n=this.tasksEvening[e+1],this.$set(this.tasksEvening,e,n),this.$set(this.tasksEvening,e+1,a));break;case"night":e=this.tasksNight.findIndex(function(e){return e.id==t.id}),a=this.tasksNight[e],"up"==t.direction&&e>0&&(s=this.tasksNight[e-1],this.$set(this.tasksNight,e,s),this.$set(this.tasksNight,e-1,a)),"down"==t.direction&&e<this.tasksNight.length-1&&(n=this.tasksNight[e+1],this.$set(this.tasksNight,e,n),this.$set(this.tasksNight,e+1,a));break;case"dawn":e=this.tasksDawn.findIndex(function(e){return e.id==t.id}),a=this.tasksDawn[e],"up"==t.direction&&e>0&&(s=this.tasksDawn[e-1],this.$set(this.tasksDawn,e,s),this.$set(this.tasksDawn,e-1,a)),"down"==t.direction&&e<this.tasksDawn.length-1&&(n=this.tasksDawn[e+1],this.$set(this.tasksDawn,e,n),this.$set(this.tasksDawn,e+1,a))}this.reorderTasks("setas")},reorderTasks:function(t){var e=this;return c()(i.a.mark(function s(){var n;return i.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if("setas"==t||""==e.orderName){s.next=4;break}e.orderName="",s.next=21;break;case 4:if(""!=e.orderName){s.next=8;break}e.orderName=t,s.next=21;break;case 8:n=null,s.t0=e.orderName,s.next="morning"===s.t0?12:"evening"===s.t0?14:"night"===s.t0?16:"dawn"===s.t0?18:20;break;case 12:return n=e.updateOrderTask(e.tasksMorning),s.abrupt("break",20);case 14:return n=e.updateOrderTask(e.tasksEvening),s.abrupt("break",20);case 16:return n=e.updateOrderTask(e.tasksNight),s.abrupt("break",20);case 18:return n=e.updateOrderTask(e.tasksDawn),s.abrupt("break",20);case 20:n.then(function(t){Object(g.j)(t)});case 21:case"end":return s.stop()}},s,e)}))()},updateOrderTask:function(t){var e,s=this;return new a.a((e=c()(i.a.mark(function e(n,a){var r,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=1,o=s,e.next=4,t.forEach(function(){var t=c()(i.a.mark(function t(e){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.$store.dispatch("task/updateTaskData",{task:e,data:{urgente:r++,sinc:0,updated_at:Object(w.a)((new Date).toISOString())}});case 2:case"end":return t.stop()}},t,s)}));return function(e){return t.apply(this,arguments)}}());case 4:o.sortTasksByPeriod(),e.t0=o.orderName,e.next="morning"===e.t0?8:"evening"===e.t0?10:"night"===e.t0?12:"dawn"===e.t0?14:16;break;case 8:return t=o.tasksMorning,e.abrupt("break",16);case 10:return t=o.tasksEvening,e.abrupt("break",16);case 12:return t=o.tasksNight,e.abrupt("break",16);case 14:return t=o.tasksDawn,e.abrupt("break",16);case 16:n(t);case 17:case"end":return e.stop()}},e,s)})),function(t,s){return e.apply(this,arguments)}))},sincPreAproveRoute:function(){var t=this;return c()(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new a.a(function(){var e=c()(i.a.mark(function e(s,n){var a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:window.inSync=!1,a=t,t.fabActive=!1,t.$bus.$on("tasks-sync-finish",function(){a.$bus.$off("tasks-sync-finish")}),Object(g.h)().then(function(){t.synchronizationRoute.requestAproveRoute(t).then(function(){t.tasks.all.forEach(function(t){Object(b.a)("task_"+t.id)}),s()})});case 5:case"end":return e.stop()}},e,t)}));return function(t,s){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e,t)}))()}}},N={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"tasks-page"},[s("div",{staticClass:"content-page"},[t.tasksMorning.length>0?[s("HourSeparator",{attrs:{model:t.morning,showreorder:t.routeBlocked()},on:{reorder:function(e){return t.reorderTasks(e)}}}),t._v(" "),t._l(t.tasksMorning,function(e){return s("TaskItem",{key:e.id,attrs:{task:e},on:{order:function(e){return t.ordernarUrgencia(e)}}})})]:t._e(),t._v(" "),t.tasksEvening.length>0?[s("HourSeparator",{attrs:{model:t.evening,showreorder:t.routeBlocked()},on:{reorder:function(e){return t.reorderTasks(e)}}}),t._v(" "),t._l(t.tasksEvening,function(e){return s("TaskItem",{key:e.id,attrs:{task:e},on:{order:function(e){return t.ordernarUrgencia(e)}}})})]:t._e(),t._v(" "),t.tasksNight.length>0?[s("HourSeparator",{attrs:{model:t.night,showreorder:t.routeBlocked()},on:{reorder:function(e){return t.reorderTasks(e)}}}),t._v(" "),t._l(t.tasksNight,function(e){return s("TaskItem",{key:e.id,attrs:{task:e},on:{order:function(e){return t.ordernarUrgencia(e)}}})})]:t._e(),t._v(" "),t.tasksDawn.length>0?[s("HourSeparator",{attrs:{model:t.dawn,showreorder:t.routeBlocked()},on:{reorder:function(e){return t.reorderTasks(e)}}}),t._v(" "),t._l(t.tasksDawn,function(e){return s("TaskItem",{key:e.id,attrs:{task:e},on:{order:function(e){return t.ordernarUrgencia(e)}}})})]:t._e()],2),t._v(" "),s("div",{staticClass:"botton-actions",class:[t.routeBlocked()?"space-between":"",""==this.orderName?"":"hidden"]},[s("div",{staticClass:"col-auto col-aproveRoute"},[s("button",{directives:[{name:"show",rawName:"v-show",value:t.routeBlocked(),expression:"routeBlocked()"}],staticClass:"mdl-button mdl-button--raised mdl-button--accent orange whited",on:{click:function(e){return t.requestAproveRoute()}}},[t._v("\n      "+t._s(t.$t("Solicitar aprovação de rota"))+"\n      ")])]),t._v(" "),s("div",{staticClass:"col-auto col-actions"},[s("div",{staticClass:"actions",class:[t.fabActive?"fab-open":""]},[s("button",{staticClass:"mdl-button  mdl-button--fab mdl-button--mini-fab orange",on:{click:function(e){return t.$router.push("/occurrence")}}},[s("i",{staticClass:"material-icons"},[t._v("warning")])]),t._v(" "),s("button",{staticClass:"mdl-button  mdl-button--fab mdl-button--mini-fab orange",on:{click:function(e){return t.$router.push("/messages")}}},[s("i",{staticClass:"material-icons message"},[t._v("message")])]),t._v(" "),s("button",{staticClass:"mdl-button mdl-button--fab  mdl-button--fab--text button-actions orange",on:{click:function(e){t.fabActive=!t.fabActive}}},[t._m(0)])])])]),t._v(" "),s("dialog",{directives:[{name:"mdl",rawName:"v-mdl"}],staticClass:"mdl-dialog",attrs:{id:"dialogLoaderRequestAproveRoute"}},[t.errorAproveRoute?s("div",{staticClass:"mdl-dialog__title"},[s("center",[s("i",{staticClass:"material-icons warning error"},[t._v("warning")]),s("br")]),t._v(" "),s("h6",[t._v(t._s(t.$t("Solicitação de aprovação de rota demorando mais que o normal!")))])],1):s("h6",{staticClass:"mdl-dialog__title"},[t._v(t._s(t.$t("Solicitando aprovação de rota")))]),t._v(" "),t.errorAproveRoute?s("div",{staticClass:"mdl-dialog__content"},[s("button",{staticClass:"mdl-button mdl-button--raised mld-button-small mdl-button--colored",on:{click:t.requestAproveRoute}},[s("span",[t._v(t._s(t.$t("Tentar Novamente")))])]),t._v(" "),s("button",{directives:[{name:"show",rawName:"v-show",value:t.routeBlocked(),expression:"routeBlocked()"}],staticClass:"mdl-button ",on:{click:t.closeModal}},[s("span",[t._v(t._s(t.$t("Cancelar")))])])]):s("div",{staticClass:"mdl-dialog__content"},[s("div",{staticClass:"tiny-loader"}),t._v(" "),s("p",[t._v(t._s(t.$t("Aguarde")))])])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("span",{attrs:{id:"nav-icon"}},[e("span"),this._v(" "),e("span"),this._v(" "),e("span"),this._v(" "),e("span")])}]};var R=s("VU/8")(T,N,!1,function(t){s("qrPg"),s("Byen")},"data-v-2bf4b45a",null);e.default=R.exports},"n8T+":function(t,e){},poJr:function(t,e,s){"use strict";e.a=r;var n=s("//Fk"),a=s.n(n);function r(t){return new a.a(function(e,s){window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,window.requestFileSystem(1,0,function(n){n.root.getFile(t,null,function(t){t.isFile&&t.remove(function(t){e(t)},function(t){s(t)})},function(t){s(t)})},function(t){s(t)})})}},qrPg:function(t,e){}});
//# sourceMappingURL=6.ef76b73dcc7246097bf6.js.map