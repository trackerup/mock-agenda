webpackJsonp([14],{"8v2F":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("woOf"),n=r.n(o),a=r("mvHQ"),s=r.n(a),c=r("//Fk"),i=r.n(c),l=r("gRE1"),u=r.n(l),m=r("Xxa5"),f=r.n(m),d=r("exGp"),v=r.n(d),_=r("Dd8w"),p=r.n(_),h=r("SBDe"),g=r("T75j"),w=function(){return g.a.getAll("form_categorias")},C=function(){return g.a.getAll("form_meta_categorias")},x=r("4YyR"),y=r("BeRe"),k=r("NYxO"),F={name:"Occurrence",components:{Form:y.default},data:function(){return{forms:[],formsCategory:[],formsCategoryMeta:[],value:"",occurenceDialog:{opened:!1},form:!1,task:null,currentResponse:null,formValues:null}},computed:p()({},Object(k.b)({currentTask:"task/currentTask",coords:"user/coords",user:"user/user"})),beforeMount:function(){var e=this;return v()(f.a.mark(function t(){return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getForms();case 2:return t.next=4,e.getFormsCategory();case 4:case"end":return t.stop()}},t,e)}))()},mounted:function(){var e=this;if(this.$emit("changeParams",{pageTitle:this.$t("Ocorrência"),mapMenu:!1,backMenu:!0}),window.localStorage.getItem("__current_form_occurrence")){var t=window.localStorage.getItem("__current_form_occurrence");this.getForms().then(function(r){e.form=u()(r).find(function(e){return e.id==t}),e.formValues=JSON.parse(window.localStorage.getItem("__current_response_occurrence")),e.occurenceDialog.opened=!0})}},watch:{currentRoute:function(e){this.checkRoute(e)},occurenceDialog:{handler:function(e){e.opened?this.$el.querySelector("#dialog-occurence").showModal():this.$el.querySelector("#dialog-occurence").close()},deep:!0}},methods:{getForms:function(){var e,t=this,r=this;return new i.a((e=v()(f.a.mark(function e(o,n){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:h.a.getAllForms().then(function(e){r.forms=e,o(r.forms)});case 1:case"end":return e.stop()}},e,t)})),function(t,r){return e.apply(this,arguments)}))},getFormsCategory:function(){var e=this;return v()(f.a.mark(function t(){return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.formsCategory=[],t.prev=1,t.next=4,w();case 4:return e.formsCategory=t.sent,t.next=7,C();case 7:e.formsCategoryMeta=t.sent,e.processaForms(),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),console.log(t.t0);case 14:case"end":return t.stop()}},t,e,[[1,11]])}))()},processaForms:function(){var e=this;this.formsCategory.map(function(t){t.ativo=!1,t.forms=[],t.forms=e.forms.filter(function(r){return e.formsCategoryMeta.filter(function(o){return o.idCategoria==t.id&&o.idFormulario==r.id&&(""==e.value||0==r.titulo.toLowerCase().indexOf(e.value.toLowerCase()))}).length})});var t=this.forms.filter(function(t){return""==e.value||t.titulo.toLowerCase().indexOf(e.value.toLowerCase())>=0});t.length&&this.formsCategory.push({nome:"Formulários",forms:t}),this.$forceUpdate()},openFormsAccordeon:function(e){var t=e.ativo;this.formsCategory.map(function(e){e.ativo=!1}),e.ativo=!t,this.$forceUpdate()},onInput:function(e){this.processaForms(),this.$forceUpdate()},clear:function(){this.value="",this.processaForms(),this.$forceUpdate()},setFormOccurence:function(e){var t=this;return v()(f.a.mark(function r(){return f.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:t.form=e,window.localStorage.removeItem("__current_response_occurrence"),window.localStorage.setItem("__current_form_occurrence",e.id),t.occurenceDialog.opened=!0;case 4:case"end":return r.stop()}},r,t)}))()},updateForm:function(e){window.localStorage.setItem("__current_response_occurrence",s()(e))},saveResponseOccurence:function(e){var t=this;return v()(f.a.mark(function r(){var o;return f.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:Object(x.g)(t.user,t.form,t.coords,e),window.localStorage.removeItem("__current_response_occurrence"),t.$bus.$emit("showMessageEmitted",{msg:t.$t("Ocorrência salva com sucesso!")}),t.formValues=null,o=t.form,t.form=null,setTimeout(function(){t.form=o},50);case 7:case"end":return r.stop()}},r,t)}))()},clearOccurenceData:function(){this.form=null,this.occurenceDialog.opened=!1,window.localStorage.removeItem("__current_response_occurrence"),window.localStorage.removeItem("__current_form_occurrence")},cancelResponseOccurence:function(){this.clearOccurenceData(),this.deleteTemporaryTask(),this.$router.push("/tasks")},deleteTemporaryTask:function(){var e=n()({},this.currentTask);Object(x.a)(e.id)}},beforeDestroy:function(){this.$store.dispatch("task/setCurrentTask",{task:null})}},O={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"page-occurrence"},[r("div",{staticClass:"mdl-app-content"},[r("h6",[e._v("Escolha qual Formulario melhor atende a sua Ocorrência")]),e._v(" "),r("div",{directives:[{name:"mdl",rawName:"v-mdl"}],staticClass:"mdl-textfield mdl-js-textfield mdl-textfield--floating-label textfield-with-icon",class:[{"is-dirty":""!=e.value}]},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.value,expression:"value"}],staticClass:"mdl-textfield__input",attrs:{type:"text",id:"pesquisar"},domProps:{value:e.value},on:{input:[function(t){t.target.composing||(e.value=t.target.value)},e.onInput]}}),e._v(" "),e._m(0),e._v(" "),r("i",{directives:[{name:"show",rawName:"v-show",value:""!=e.value,expression:"value != ''"}],staticClass:"material-icons mdl-textfield__label__icon reorder clearicon",on:{click:e.clear}},[e._v("close")]),e._v(" "),r("i",{directives:[{name:"show",rawName:"v-show",value:""==e.value,expression:"value == ''"}],staticClass:"material-icons mdl-textfield__label__icon reorder"},[e._v("search")])]),e._v(" "),r("div",{staticClass:"accordeon"},[e._l(e.formsCategory,function(t,o){return[t.forms&&t.forms.length?r("div",{key:o,staticClass:"painel",class:[t.ativo?"painel--ativo":""]},[r("div",{staticClass:"painel__title",on:{click:function(r){return e.openFormsAccordeon(t)}}},[r("span",[e._v(e._s(t.nome))]),e._v(" "),t.ativo?r("i",{staticClass:"material-icons"},[e._v("\n              keyboard_arrow_up\n            ")]):r("i",{staticClass:"material-icons"},[e._v("\n              keyboard_arrow_down\n            ")])]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:t.ativo,expression:"category.ativo"}],staticClass:"painel__content"},[r("ul",{staticClass:"painel__list mdl-list"},e._l(t.forms,function(t,o){return r("li",{key:o,staticClass:"mdl-list__item",on:{click:function(r){return e.setFormOccurence(t)}}},[r("span",{staticClass:"mdl-list__item-primary-content"},[e._v("\n                    "+e._s(t.titulo)+"\n                  ")])])}),0)])]):e._e()]})],2)]),e._v(" "),r("dialog",{directives:[{name:"show",rawName:"v-show",value:e.occurenceDialog.opened,expression:"occurenceDialog.opened"}],staticClass:"mdl-dialog full",attrs:{id:"dialog-occurence"}},[r("div",{staticClass:"mdl-dialog__content"},[e.form&&e.form.titulo?r("h5",{staticClass:"mdl-dialog__title"},[e._v(e._s(e.$t(e.form.titulo)))]):e._e(),e._v(" "),r("div",{staticClass:"inResponse"},[e.form?r("Form",{ref:"occurrenceForm",attrs:{idForm:e.form.id,typeForm:"simple",value:e.formValues},on:{save:e.saveResponseOccurence,cancel:e.cancelResponseOccurence,input:e.updateForm}}):e._e()],1)])])])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("label",{staticClass:"mdl-textfield__label",attrs:{for:"pesquisar"}},[t("span",[this._v("Pesquisar")])])}]};var b=r("VU/8")(F,O,!1,function(e){r("Xine")},"data-v-bfbd4336",null);t.default=b.exports},Xine:function(e,t){}});
//# sourceMappingURL=14.2eb37d1a7ee3023c4fb5.js.map