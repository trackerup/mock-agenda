{"version":3,"sources":["webpack:///src/pages/map/Routemap.vue","webpack:///./src/pages/map/Routemap.vue?f6a7","webpack:///./src/pages/map/Routemap.vue"],"names":["Routemap","name","data","mapName","tasksMorning","tasksEvening","tasksNight","tasksDawn","synchronizationRoute","map","mapOptions","computed","extends_default","Object","vuex_esm","tasks","user","coords","viewDate","created","_this","this","asyncToGenerator_default","regenerator_default","a","mark","_callee","wrap","_context","prev","next","$store","dispatch","$geolocation","getLocation","stop","beforeMount","ComponentTasksClass","vue_esm","extend","mounted","$bus","$emit","pageTitle","$t","mapMenu","backMenu","initializeMapRota","sortTasksByPeriod","methods","element","center","google","maps","LatLng","zoom","mapTypeControl","mapTypeControlOptions","style","MapTypeControlStyle","HORIZONTAL_BAR","position","ControlPosition","TOP_LEFT","streetViewControl","streetViewControlOptions","RIGHT_BOTTOM","zoomControl","zoomControlOptions","fullscreenControl","mapTypeId","MapTypeId","ROADMAP","mapContainer","$refs","Map","_ref","_self","tarefa","then","_callee2","tarefas","j","planedStartParsed","color","i","rotas","cords","_context2","window","directionsDisplay","setMap","length","JSON","parse","planedStart","hora","urgente","parseInt","filter","task","status","deletada","dataTarefa","sort","b","keyA","keyB","latitude","longitude","push","calculateAndDisplayRoute","_x","apply","arguments","directionsService","DirectionsService","DirectionsRenderer","polylineOptions","strokeColor","optimizeWaypoints","waypts","_currentUserCoord","getters","indexWithCoords","location","stopover","route","origin","destination","travelMode","waypoints","provideRouteAlternatives","response","setDirections","indexWithoutCoord","map_Routemap","render","_vm","_h","$createElement","_c","staticClass","ref","_v","on","click","$event","$router","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"js/17.cfcbf0fc521b10f9937d.js","sourcesContent":["<template>\r\n  <div>\r\n    <div class=\"content-page\">\r\n      <div class=\"google-map\" :ref=\"mapName\"></div>\r\n    </div>\r\n    <div class=\"actions-bottom-left\">\r\n      <button @click=\"$router.push('/messages')\"\r\n        class=\"mdl-button  mdl-button--fab  orange\">\r\n        <i class=\"material-icons message\">message</i>\r\n      </button>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\n/* global google */\r\nimport Vue from 'vue'\r\nimport { mapGetters } from 'vuex'\r\n// import { existsInArray } from '../../utils'\r\nimport SynchronizationRoute from '../../plugins/routes/synchronizationRoute'\r\nimport { getTarefasByDate } from '../../plugins/persistence/entities/tarefa'\r\n\r\nexport default {\r\n  name: 'Routemap',\r\n  data: () => ({\r\n    mapName: 'task-map',\r\n    tasksMorning: [],\r\n    tasksEvening: [],\r\n    tasksNight: [],\r\n    tasksDawn: [],\r\n    synchronizationRoute: null,\r\n    map: null,\r\n    mapOptions: null\r\n  }),\r\n  computed: {\r\n    ...mapGetters({\r\n      tasks: 'task/tasks',\r\n      user: 'user/user',\r\n      coords: 'user/coords',\r\n      viewDate: 'task/viewDate'\r\n    })\r\n  },\r\n  async created () {\r\n    await this.$store.dispatch('task/getTasks', {})\r\n    this.$geolocation.getLocation(this)\r\n  },\r\n  beforeMount () {\r\n    const ComponentTasksClass = Vue.extend(SynchronizationRoute)\r\n    this.synchronizationRoute = new ComponentTasksClass()\r\n  },\r\n  mounted () {\r\n    this.$bus.$emit('tasks-sync', true)\r\n    this.$emit('changeParams', {\r\n      pageTitle: this.$t('Rota no mapa'),\r\n      mapMenu: false,\r\n      backMenu: true\r\n    })\r\n    if (this.map == null) {\r\n      this.initializeMapRota()\r\n      this.sortTasksByPeriod()\r\n    }\r\n  },\r\n  methods: {\r\n    initializeMapRota: function () {\r\n      var element = {\r\n        latitude: -23.5422851,\r\n        longitude: -46.6402859\r\n      }\r\n\r\n      this.mapOptions = {\r\n        center: new google.maps.LatLng(element.latitude, element.longitude),\r\n        zoom: 17,\r\n        mapTypeControl: false,\r\n        mapTypeControlOptions: {\r\n          style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR,\r\n          position: google.maps.ControlPosition.TOP_LEFT\r\n        },\r\n        streetViewControl: true,\r\n        streetViewControlOptions: {\r\n          position: google.maps.ControlPosition.RIGHT_BOTTOM\r\n        },\r\n        zoomControl: true,\r\n        zoomControlOptions: {\r\n          position: google.maps.ControlPosition.RIGHT_BOTTOM\r\n        },\r\n        fullscreenControl: false,\r\n        mapTypeId: google.maps.MapTypeId.ROADMAP\r\n      }\r\n\r\n      var mapContainer = this.$refs[this.mapName]\r\n      this.map = new google.maps.Map(mapContainer, this.mapOptions)\r\n    },\r\n    sortTasksByPeriod () {\r\n      let _self = this\r\n      getTarefasByDate().then(\r\n        async function (tarefas) {\r\n          if (window.directionsDisplay) {\r\n            window.directionsDisplay.setMap(null)\r\n            window.directionsDisplay = null\r\n          }\r\n\r\n          if (tarefas) {\r\n            // var tasks = tarefas.filter(task => {\r\n            //   return task.status != 'concluida' && task.status != 'malsucedida'\r\n            // })\r\n\r\n            for (var j = 0; j < tarefas.length; j++) {\r\n              let planedStartParsed = JSON.parse(tarefas[j].planedStart)\r\n              let planedStartHour = planedStartParsed.hora\r\n              if (planedStartHour >= 12) {\r\n                tarefas[j].urgente = parseInt(tarefas[j].urgente) + 10000000\r\n              }\r\n            }\r\n\r\n            var tasks = tarefas.filter(task => {\r\n              return task.status != 'concluida' && task.status != 'malsucedida' && task.deletada != 1 && task.dataTarefa == _self.viewDate && task.deletada == '0'\r\n            })\r\n\r\n            tasks = tasks.sort(function (a, b) {\r\n              var keyA = a.urgente\r\n              var keyB = b.urgente\r\n              if (keyA < keyB) return -1\r\n              if (keyA > keyB) return 1\r\n              return 0\r\n            })\r\n            var color = ''\r\n            var i\r\n            var rotas = []\r\n            var cords\r\n\r\n            for (i = 0; i < tasks.length; i++) {\r\n              cords = [\r\n                tasks[i].latitude,\r\n                tasks[i].longitude\r\n              ]\r\n\r\n              rotas.push(cords)\r\n            }\r\n            color = '#d32f2f'\r\n            _self.calculateAndDisplayRoute(rotas, color)\r\n          }\r\n        })\r\n    },\r\n    calculateAndDisplayRoute: function (cords, color) {\r\n      var directionsService = new google.maps.DirectionsService()\r\n      window.directionsDisplay = new google.maps.DirectionsRenderer({\r\n        polylineOptions: {\r\n          strokeColor: color\r\n        },\r\n        optimizeWaypoints: false\r\n      })\r\n      window.directionsDisplay.setMap(this.map)\r\n      var waypts = []\r\n      const _currentUserCoord = this.$store.getters['user/coords']\r\n      if (_currentUserCoord) {\r\n        for (var indexWithCoords = 0; indexWithCoords < cords.length - 1; indexWithCoords++) {\r\n          waypts.push({\r\n            location: new google.maps.LatLng(cords[indexWithCoords][0], cords[indexWithCoords][1]),\r\n            stopover: true\r\n          })\r\n        }\r\n        directionsService.route({\r\n          origin: new google.maps.LatLng(_currentUserCoord.latitude, _currentUserCoord.longitude),\r\n          destination: new google.maps.LatLng(cords[cords.length - 1][0], cords[cords.length - 1][1]),\r\n          travelMode: 'DRIVING',\r\n          waypoints: waypts,\r\n          optimizeWaypoints: false,\r\n          provideRouteAlternatives: true\r\n        }, function (response, status) {\r\n          if (status == 'OK') {\r\n            window.directionsDisplay.setDirections(response)\r\n          }\r\n        })\r\n      } else {\r\n        for (var indexWithoutCoord = 1; indexWithoutCoord < cords.length - 1; indexWithoutCoord++) {\r\n          waypts.push({\r\n            location: new google.maps.LatLng(cords[indexWithoutCoord][0], cords[indexWithoutCoord][1]),\r\n            stopover: true\r\n          })\r\n        }\r\n        directionsService.route({\r\n          origin: new google.maps.LatLng(cords[0][0], cords[0][1]),\r\n          destination: new google.maps.LatLng(cords[cords.length - 1][0], cords[cords.length - 1][1]),\r\n          travelMode: 'DRIVING',\r\n          waypoints: waypts,\r\n          optimizeWaypoints: false,\r\n          provideRouteAlternatives: true\r\n        }, function (response, status) {\r\n          if (status == 'OK') {\r\n            window.directionsDisplay.setDirections(response)\r\n          }\r\n        })\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\r\n<style scoped>\r\n  .google-map {\r\n    width: 100%;\r\n    height: 100%;\r\n    margin: 0 auto;\r\n    background: gray;\r\n  }\r\n\r\n  .content-page {\r\n    position: absolute;\r\n    top: 0;\r\n    width: 100%;\r\n    height: -webkit-fill-available;\r\n  }\r\n  .actions-bottom-left {\r\n    bottom: 22px;\r\n    left: 14px;\r\n    position: fixed;\r\n    z-index: 99999;\r\n  }\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/pages/map/Routemap.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('div',{staticClass:\"content-page\"},[_c('div',{ref:_vm.mapName,staticClass:\"google-map\"})]),_vm._v(\" \"),_c('div',{staticClass:\"actions-bottom-left\"},[_c('button',{staticClass:\"mdl-button  mdl-button--fab  orange\",on:{\"click\":function($event){return _vm.$router.push('/messages')}}},[_c('i',{staticClass:\"material-icons message\"},[_vm._v(\"message\")])])])])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-3bb72c77\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/pages/map/Routemap.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-3bb72c77\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./Routemap.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./Routemap.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./Routemap.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-3bb72c77\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./Routemap.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-3bb72c77\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pages/map/Routemap.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}