webpackJsonp([17],{eD2V:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o("Xxa5"),a=o.n(n),s=o("exGp"),i=o.n(s),r=o("Dd8w"),l=o.n(r),p=o("7+uW"),u=o("NYxO"),c=o("Q+0R"),g=o("4YyR"),d={name:"Routemap",data:function(){return{mapName:"task-map",tasksMorning:[],tasksEvening:[],tasksNight:[],tasksDawn:[],synchronizationRoute:null,map:null,mapOptions:null}},computed:l()({},Object(u.b)({tasks:"task/tasks",user:"user/user",coords:"user/coords",viewDate:"task/viewDate"})),created:function(){var t=this;return i()(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("task/getTasks",{});case 2:t.$geolocation.getLocation(t);case 3:case"end":return e.stop()}},e,t)}))()},beforeMount:function(){var t=p.default.extend(c.a);this.synchronizationRoute=new t},mounted:function(){this.$bus.$emit("tasks-sync",!0),this.$emit("changeParams",{pageTitle:this.$t("Rota no mapa"),mapMenu:!1,backMenu:!0}),null==this.map&&(this.initializeMapRota(),this.sortTasksByPeriod())},methods:{initializeMapRota:function(){var t=-23.5422851,e=-46.6402859;this.mapOptions={center:new google.maps.LatLng(t,e),zoom:17,mapTypeControl:!1,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.TOP_LEFT},streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},fullscreenControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP};var o=this.$refs[this.mapName];this.map=new google.maps.Map(o,this.mapOptions)},sortTasksByPeriod:function(){var t,e=this;Object(g.c)().then((t=i()(a.a.mark(function t(o){var n,s,i,r,l,p,u;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(window.directionsDisplay&&(window.directionsDisplay.setMap(null),window.directionsDisplay=null),o){for(n=0;n<o.length;n++)s=JSON.parse(o[n].planedStart),s.hora>=12&&(o[n].urgente=parseInt(o[n].urgente)+1e7);for(i=(i=o.filter(function(t){return"concluida"!=t.status&&"malsucedida"!=t.status&&1!=t.deletada&&t.dataTarefa==e.viewDate&&"0"==t.deletada})).sort(function(t,e){var o=t.urgente,n=e.urgente;return o<n?-1:o>n?1:0}),r="",p=[],l=0;l<i.length;l++)u=[i[l].latitude,i[l].longitude],p.push(u);r="#d32f2f",e.calculateAndDisplayRoute(p,r)}case 2:case"end":return t.stop()}},t,this)})),function(e){return t.apply(this,arguments)}))},calculateAndDisplayRoute:function(t,e){var o=new google.maps.DirectionsService;window.directionsDisplay=new google.maps.DirectionsRenderer({polylineOptions:{strokeColor:e},optimizeWaypoints:!1}),window.directionsDisplay.setMap(this.map);var n=[],a=this.$store.getters["user/coords"];if(a){for(var s=0;s<t.length-1;s++)n.push({location:new google.maps.LatLng(t[s][0],t[s][1]),stopover:!0});o.route({origin:new google.maps.LatLng(a.latitude,a.longitude),destination:new google.maps.LatLng(t[t.length-1][0],t[t.length-1][1]),travelMode:"DRIVING",waypoints:n,optimizeWaypoints:!1,provideRouteAlternatives:!0},function(t,e){"OK"==e&&window.directionsDisplay.setDirections(t)})}else{for(var i=1;i<t.length-1;i++)n.push({location:new google.maps.LatLng(t[i][0],t[i][1]),stopover:!0});o.route({origin:new google.maps.LatLng(t[0][0],t[0][1]),destination:new google.maps.LatLng(t[t.length-1][0],t[t.length-1][1]),travelMode:"DRIVING",waypoints:n,optimizeWaypoints:!1,provideRouteAlternatives:!0},function(t,e){"OK"==e&&window.directionsDisplay.setDirections(t)})}}}},m={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("div",{staticClass:"content-page"},[o("div",{ref:t.mapName,staticClass:"google-map"})]),t._v(" "),o("div",{staticClass:"actions-bottom-left"},[o("button",{staticClass:"mdl-button  mdl-button--fab  orange",on:{click:function(e){return t.$router.push("/messages")}}},[o("i",{staticClass:"material-icons message"},[t._v("message")])])])])},staticRenderFns:[]};var f=o("VU/8")(d,m,!1,function(t){o("kDn9")},"data-v-3bb72c77",null);e.default=f.exports},kDn9:function(t,e){}});
//# sourceMappingURL=17.cfcbf0fc521b10f9937d.js.map