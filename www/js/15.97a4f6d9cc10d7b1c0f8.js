webpackJsonp([15],{"47fz":function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=t("Xxa5"),i=t.n(a),r=t("exGp"),n=t.n(r),l=t("Dd8w"),o=t.n(l),u=t("eZEh"),c=t("NYxO"),m=t("PJh5"),d=t.n(m),h={name:"Messages",data:function(){return{hasError:!1,messageError:"",obrigatorio:!1}},mounted:function(){if(this.$emit("changeParams",{pageTitle:this.$t("Mensagens"),mapMenu:!1,backMenu:!0}),this.$bus.$emit("messages-sync",!0),void 0!==this.messages.all)for(var s=0;s<this.messages.all.length;s++)null==this.messages.all[s].lida&&this.messages.all[s].id&&this.messages.all[s].autor!=this.user.id&&this.$bus.$emit("send-read-message",!0,this.messages.all[s].id),null==this.messages.all[s].entregue&&this.messages.all[s].id&&this.messages.all[s].autor!=this.user.id&&this.$bus.$emit("mark-message-entregue",!0,this.messages.all[s].id);this.scrollDiv(),this.listenMessages()},destroyed:function(){this.$bus.$emit("messages-sync-off")},computed:o()({},Object(c.b)({token:"user/token",user:"user/user",messages:"message/messages",currentMessage:"message/currentMessage"})),filters:{moment:function(s){return d()(s).format("DD/MM/YYYY HH:mm:ss")}},methods:{listenMessages:function(){var s=this;this.$bus.$off("new-messages"),this.$bus.$on("new-messages",function(){s.scrollDiv(),setTimeout(function(){s.scrollDiv()},100)})},saveMessage:function(s){var e=this;if(void 0!=this.$refs.message.value&&""!=this.$refs.message.value){console.log("Teste MSG",{msg:this.$refs.message.value,user:this.user.id});var t={mensagem:this.$refs.message.value,user:this.user.id};Object(u.d)(t).then(function(s){var t;e.$store.dispatch("message/getMessages").then((t=n()(i.a.mark(function t(a){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.scrollDiv(),setTimeout(function(){e.scrollDiv()},100),e.$bus.$emit("send-chat-message",!0,s),e.$refs.message.value="";case 4:case"end":return t.stop()}},t,this)})),function(s){return t.apply(this,arguments)}))})}else this.messageError=this.$t("Este campo é obrigatório"),this.hasError=!0},checkSendMessage:function(){void 0!=this.$refs.message.value&&""!=this.$refs.message.value?(this.hasError&&(this.hasError=!this.hasError),this.send(this,{msg:this.$refs.message.value,user:this.user.id}),this.$refs.message.value=""):(this.hasError=!0,this.messageError=this.$t("Este campo é obrigatório")),this.scrollDiv()},scrollDiv:function(){if(document.getElementsByClassName("content-messages")){var s=document.getElementsByClassName("content-messages")[0];void 0!==s.scrollHeight&&(s.scrollTop=s.scrollHeight)}},moment:function(){return d()()},send:function(s,e){var t=this;return n()(i.a.mark(function s(){return i.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return void 0!==e&&e&&Object(u.d)(e).then(function(){var s=n()(i.a.mark(function s(e){return i.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:case"end":return s.stop()}},s,this)}));return function(e){return s.apply(this,arguments)}}()),s.next=3,t.scrollDiv();case 3:case"end":return s.stop()}},s,t)}))()}}},g={render:function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("div",{staticClass:"content-page"},[t("div",{staticClass:"content-messages"},s._l(s.messages.all,function(e,a){return t("div",{key:a,staticClass:"mdl-card item",class:e.class+" "+(e.autor!=s.user.id?"received":"sended"),attrs:{id:"msg_"+e.id}},[t("p",["0"!=e.autor&&e.autor!=s.user.id?t("span",{staticClass:"textOrange chat-name user-id",attrs:{id:"user-id-"+e.id}},[s._v(s._s(void 0===e.usuarioAutor?"AT":e.usuarioAutor))]):s._e(),s._v(" "),"0"!=e.autor&&e.autor==s.user.id?t("span",{staticClass:"textOrange chat-name user-you"},[s._v(s._s(s.$t("Você")))]):s._e(),s._v(" "),t("span",{staticClass:"textOrange right chat-hour"},[s._v(" "+s._s(s._f("moment")(e.created_at,e.criada)))])]),s._v(" "),t("span",{staticClass:"chat-message"},[s._v(s._s(e.mensagem))]),s._v(" "),"0"!=e.autor&&e.autor==s.user.id&&null==e.enviada?t("i",{staticClass:"material-icons check notSent"},[s._v("av_timer")]):s._e(),s._v(" "),"0"!=e.autor&&e.autor==s.user.id&&null!=e.enviada?t("i",{staticClass:"material-icons check",class:"false"!=e.bosslida&&null!=e.bosslida?"green":""},[s._v("check")]):s._e(),s._v(" "),"0"!=e.autor&&e.autor==s.user.id&&"false"!=e.bosslida&&null!=e.bosslida?t("i",{staticClass:"material-icons check check2",class:"false"!=e.bosslida&&null!=e.bosslida?"green":""},[s._v("check")]):s._e()])}),0),s._v(" "),t("div",{staticClass:"item message"},[t("div",{directives:[{name:"mdl",rawName:"v-mdl"}],staticClass:"mdl-textfield mdl-js-textfield mdl-textfield--floating-label",class:{"is-invalid":s.hasError}},[t("input",{ref:"message",staticClass:"mdl-textfield__input",attrs:{type:"inputMensagem",id:"inputMensagem"}}),s._v(" "),t("label",{staticClass:"mdl-textfield__label",attrs:{for:"inputMensagem"}},[s._v(s._s(s.$t("Mensagem")))]),s._v(" "),s.hasError?t("span",{staticClass:"mdl-error",domProps:{innerHTML:s._s(s.messageError)}}):s._e()]),s._v(" "),t("span",{},[t("button",{staticClass:"mdl-button  mdl-button--fab ",on:{click:function(e){return s.saveMessage()}}},[t("i",{staticClass:"material-icons arrow-right"},[s._v("keyboard_arrow_right")])])])])])},staticRenderFns:[]};var v=t("VU/8")(h,g,!1,function(s){t("PYAB")},"data-v-5c268480",null);e.default=v.exports},PYAB:function(s,e){}});
//# sourceMappingURL=15.97a4f6d9cc10d7b1c0f8.js.map