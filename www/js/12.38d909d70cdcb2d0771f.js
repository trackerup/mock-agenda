webpackJsonp([12],{"/kus":function(t,e){},a5K0:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=s("//Fk"),r=s.n(n),a=s("Xxa5"),i=s.n(a),o=s("exGp"),u=s.n(o),d=s("Dd8w"),c=s.n(d),h=s("7+uW"),k=s("DYhV"),g=s("3uXF"),f=s("NYxO"),l=s("0xDb"),p=s("PqRL"),v=s("Q+0R"),m=s("4YyR"),w=s("hvEy"),b=s("PJh5"),T=s.n(b),$={name:"FutureTasks",components:{HourSeparator:g.a,TaskItem:k.a},data:function(){return{tasksMorning:[],tasksEvening:[],tasksNight:[],tasksDawn:[],synchronizationTasks:null,synchronizationRoute:null,allowOrder:!0,orderName:"",dateFuturo:""}},computed:c()({},Object(f.b)({tasks:"task/tasks",user:"user/user",viewDate:"task/viewDate"}),{morning:function(){return{name:"morning",time:"07:00",period:this.$t("ManhÃ£"),reorder:!1}},evening:function(){return{name:"evening",time:"13:00",period:this.$t("Tarde"),reorder:!1}},night:function(){return{name:"night",time:"19:00",period:this.$t("Noite"),reorder:!1}},dawn:function(){return{name:"dawn",time:"01:00",period:this.$t("Madrugada"),reorder:!1}}}),watch:{tasks:function(t){this.sortTasksByPeriod()}},created:function(){var t=this;return u()(i.a.mark(function e(){var s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(s=new Date).setDate(s.getDate()+1),e.next=4,t.$store.dispatch("task/updateViewDate",{date:s});case 4:return e.next=6,t.$store.dispatch("task/getTasks",{});case 6:return e.next=8,t.$store.dispatch("task/setCurrentTask",{task:null});case 8:case"end":return e.stop()}},e,t)}))()},beforeMount:function(){var t=h.default.extend(p.a);this.synchronizationTasks=new t;var e=h.default.extend(v.a);this.synchronizationRoute=new e},mounted:function(){var t=this;window.inSync=!1,this.synchronizationTasks.makeTasksSync(this,!1,!0).then(function(e){t.$bus.$emit("tasks-sync",!0)}).catch(function(){t.$bus.$emit("tasks-sync",!1)}),this.$emit("changeParams",{pageTitle:this.$t("OS Futuras"),mapMenu:!0,backMenu:!1}),this.sortTasksByPeriod()},methods:{dataFormat:function(t){return t?T()(t).format("DD/MM/YYYY"):""},sortTasksByPeriod:function(){var t=this,e=this;if(this.tasksMorning=[],this.tasksEvening=[],this.tasksNight=[],this.tasksDawn=[],this.tasks.all){var s=this.tasks.all.filter(function(t){return t.rota==e.user.route.id&&"concluida"!=t.status&&"malsucedida"!=t.status&&t.dataTarefa>=e.viewDate});if(s.sort(function(t,e){return t.dataTarefa<e.dataTarefa?-1:t.dataTarefa>e.dataTarefa?1:0}),s.length){this.dateFuturo=s[0].dataTarefa;var n=s.filter(function(e){return e.dataTarefa==t.dateFuturo});n.sort(function(t,e){return parseInt(t.urgente)<parseInt(e.urgente)?-1:parseInt(t.urgente)>parseInt(e.urgente)?1:0}),n.forEach(function(e){var s=JSON.parse(e.planedStart).hora;s>=1&&s<=6?Object(l.b)(t.tasksDawn,e)||t.tasksDawn.push(e):s>=7&&s<=12?Object(l.b)(t.tasksMorning,e)||t.tasksMorning.push(e):s>=13&&s<=18?Object(l.b)(t.tasksEvening,e)||t.tasksEvening.push(e):s>=19&&s<=23&&(Object(l.b)(t.tasksNight,e)||t.tasksNight.push(e))})}}},routeBlocked:function(){return!(!this.user||!this.user.route||"1"!=this.user.route.status)},ordernarUrgencia:function(t){var e,s,n,r;switch(this.orderName){case"morning":e=this.tasksMorning.findIndex(function(e){return e.id==t.id}),r=this.tasksMorning[e],"up"==t.direction&&e>0&&(s=this.tasksMorning[e-1],this.$set(this.tasksMorning,e,s),this.$set(this.tasksMorning,e-1,r)),"down"==t.direction&&e<this.tasksMorning.length-1&&(n=this.tasksMorning[e+1],this.$set(this.tasksMorning,e,n),this.$set(this.tasksMorning,e+1,r));break;case"evening":e=this.tasksEvening.findIndex(function(e){return e.id==t.id}),r=this.tasksEvening[e],"up"==t.direction&&e>0&&(s=this.tasksEvening[e-1],this.$set(this.tasksEvening,e,s),this.$set(this.tasksEvening,e-1,r)),"down"==t.direction&&e<this.tasksEvening.length-1&&(n=this.tasksEvening[e+1],this.$set(this.tasksEvening,e,n),this.$set(this.tasksEvening,e+1,r));break;case"night":e=this.tasksNight.findIndex(function(e){return e.id==t.id}),r=this.tasksNight[e],"up"==t.direction&&e>0&&(s=this.tasksNight[e-1],this.$set(this.tasksNight,e,s),this.$set(this.tasksNight,e-1,r)),"down"==t.direction&&e<this.tasksNight.length-1&&(n=this.tasksNight[e+1],this.$set(this.tasksNight,e,n),this.$set(this.tasksNight,e+1,r));break;case"dawn":e=this.tasksDawn.findIndex(function(e){return e.id==t.id}),r=this.tasksDawn[e],"up"==t.direction&&e>0&&(s=this.tasksDawn[e-1],this.$set(this.tasksDawn,e,s),this.$set(this.tasksDawn,e-1,r)),"down"==t.direction&&e<this.tasksDawn.length-1&&(n=this.tasksDawn[e+1],this.$set(this.tasksDawn,e,n),this.$set(this.tasksDawn,e+1,r))}this.reorderTasks("setas")},reorderTasks:function(t){var e=this;return u()(i.a.mark(function s(){var n;return i.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if("setas"==t||""==e.orderName){s.next=4;break}e.orderName="",s.next=21;break;case 4:if(""!=e.orderName){s.next=8;break}e.orderName=t,s.next=21;break;case 8:n=null,s.t0=e.orderName,s.next="morning"===s.t0?12:"evening"===s.t0?14:"night"===s.t0?16:"dawn"===s.t0?18:20;break;case 12:return n=e.updateOrderTask(e.tasksMorning),s.abrupt("break",20);case 14:return n=e.updateOrderTask(e.tasksEvening),s.abrupt("break",20);case 16:return n=e.updateOrderTask(e.tasksNight),s.abrupt("break",20);case 18:return n=e.updateOrderTask(e.tasksDawn),s.abrupt("break",20);case 20:n.then(function(t){Object(m.j)(t)});case 21:case"end":return s.stop()}},s,e)}))()},updateOrderTask:function(t){var e,s=this;return new r.a((e=u()(i.a.mark(function e(n,r){var a,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=1,o=s,e.next=4,t.forEach(function(){var t=u()(i.a.mark(function t(e){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.$store.dispatch("task/updateTaskData",{task:e,data:{urgente:a++,sinc:0,updated_at:Object(w.a)((new Date).toISOString())}});case 2:case"end":return t.stop()}},t,s)}));return function(e){return t.apply(this,arguments)}}());case 4:o.sortTasksByPeriod(),e.t0=o.orderName,e.next="morning"===e.t0?8:"evening"===e.t0?10:"night"===e.t0?12:"dawn"===e.t0?14:16;break;case 8:return t=o.tasksMorning,e.abrupt("break",16);case 10:return t=o.tasksEvening,e.abrupt("break",16);case 12:return t=o.tasksNight,e.abrupt("break",16);case 14:return t=o.tasksDawn,e.abrupt("break",16);case 16:n(t);case 17:case"end":return e.stop()}},e,s)})),function(t,s){return e.apply(this,arguments)}))}}},D={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"tasks-page"},[s("div",{staticClass:"content-page"},[""!=t.dateFuturo?s("div",{staticClass:"mdl-grid hour-item"},[s("div",{staticClass:"mdl-toolbar-section-start body-1"},[t._v("\n        "+t._s(t.dataFormat(t.dateFuturo))+"\n      ")]),t._v(" "),s("div",{staticClass:"mdl-toolbar-section-end mdl-caption"})]):t._e(),t._v(" "),t.tasksMorning.length>0?[s("HourSeparator",{attrs:{model:t.morning,showreorder:t.routeBlocked()},on:{reorder:function(e){return t.reorderTasks(e)}}}),t._v(" "),t._l(t.tasksMorning,function(e){return s("TaskItem",{key:e.id,attrs:{task:e},on:{order:function(e){return t.ordernarUrgencia(e)}}})})]:t._e(),t._v(" "),t.tasksEvening.length>0?[s("HourSeparator",{attrs:{model:t.evening,showreorder:t.routeBlocked()},on:{reorder:function(e){return t.reorderTasks(e)}}}),t._v(" "),t._l(t.tasksEvening,function(e){return s("TaskItem",{key:e.id,attrs:{task:e},on:{order:function(e){return t.ordernarUrgencia(e)}}})})]:t._e(),t._v(" "),t.tasksNight.length>0?[s("HourSeparator",{attrs:{model:t.night,showreorder:t.routeBlocked()},on:{reorder:function(e){return t.reorderTasks(e)}}}),t._v(" "),t._l(t.tasksNight,function(e){return s("TaskItem",{key:e.id,attrs:{task:e},on:{order:function(e){return t.ordernarUrgencia(e)}}})})]:t._e(),t._v(" "),t.tasksDawn.length>0?[s("HourSeparator",{attrs:{model:t.dawn,showreorder:t.routeBlocked()},on:{reorder:function(e){return t.reorderTasks(e)}}}),t._v(" "),t._l(t.tasksDawn,function(e){return s("TaskItem",{key:e.id,attrs:{task:e},on:{order:function(e){return t.ordernarUrgencia(e)}}})})]:t._e()],2),t._v(" "),s("div",{staticClass:"actions",class:[""==this.orderName?"":"hidden"]},[s("button",{staticClass:"mdl-button  mdl-button--fab  orange",on:{click:function(e){return t.$router.push("/messages")}}},[s("i",{staticClass:"material-icons message"},[t._v("message")])])])])},staticRenderFns:[]};var N=s("VU/8")($,D,!1,function(t){s("nXTP"),s("/kus")},"data-v-431912e8",null);e.default=N.exports},nXTP:function(t,e){}});
//# sourceMappingURL=12.38d909d70cdcb2d0771f.js.map