webpackJsonp([2],{GXXR:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("Dd8w"),r=a.n(s),n=a("Xxa5"),i=a.n(n),o=a("exGp"),c=a.n(o),d=a("mvHQ"),u=a.n(d),l=a("SBDe"),m=a("tJgT"),f=a("fZjL"),h=a.n(f),p=a("pFYg"),_=a.n(p),k=a("NYxO"),v=a("M6Fp"),S=a("PJh5"),T=a.n(S),g={name:"TaskDescription",components:{CardExpand:v.a},props:{task:{type:Object,required:!0,default:function(){return{id:0,title:"",status:"",address:""}}}},mounted:function(){for(var t=document.getElementsByClassName("expandNow"),e=0;e<t.length;e++){t[e].childNodes[0].childNodes[0].childNodes[2].click()}},computed:r()({},Object(k.b)({currentTask:"task/currentTask"}),{periodo:function(){return'{"hora":7,"minuto":0}'==this.currentTask.planedStart?this.$t("Manhã"):this.$t("Tarde")},metaData:function(){var t=[];if(this.currentTask.metaDados)for(var e in this.task.metaDados)if(!this.currentTask.metaDados[e].meta_key.startsWith("__"))try{t.push({meta_key:this.currentTask.metaDados[e].meta_key,meta_value:JSON.parse(this.currentTask.metaDados[e].meta_value)})}catch(a){t.push(this.currentTask.metaDados[e])}return t}}),methods:{limpaComent:function(t){var e=new RegExp(String.fromCharCode(160),"g");return t.replace(e," ")},isDetalheMeta:function(t){if(0!=t.meta_key.indexOf("__")){if("string"!=typeof t.meta_value)return"object"!=_()(t.meta_value)||h()(t.meta_value).length>0;if(""!=t.meta_value&&"[]"!=t.meta_value)return!0}return!1}},filters:{formatDataMeta:function(t){return t?t.slice(6,8)+"/"+t.slice(4,6)+"/"+t.slice(0,4):t},formatDataComment:function(t){if(!t)return t;try{return T()(t).format("DD/MM/YYYY HH:mm:ss")}catch(e){return t}}}},w={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"task-description"},[t._e(),t._v(" "),a("div",{staticClass:"mdl-card"},[a("h6",[t._v(t._s(t.$t("Período")))]),t._v(" "),a("div",{staticClass:"mdl-grid mdl-grid--no-spacing dados"},[a("div",{staticClass:"col"},[t._v(t._s(t.periodo))])])]),t._v(" "),null!=t.currentTask.comentario&&""!=t.currentTask.comentario?a("card-expand",{attrs:{title:t.$t("Observações")}},[a("div",{domProps:{innerHTML:t._s(t.limpaComent(t.currentTask.comentario))}})]):t._e(),t._v(" "),t.currentTask.historico&&t.currentTask.historico.length?a("card-expand",{key:"historicoOS",attrs:{title:"Comentários"}},[a("ul",{staticClass:"mdl-list lista-dados"},[t._l(t.currentTask.historico,function(e,s){return[a("li",{key:s,staticClass:"mdl-list__item mdl-list__item--two-line"},[a("span",{staticClass:"mdl-list__item-primary-content"},[a("h6",[t._v(t._s(e.mensagem))]),t._v(" "),a("span",[t._v("\n              "+t._s(t._f("formatDataComment")(e.data))+"\n              ")])]),t._v(" "),"tecnico"==e.tipo?a("span",{staticClass:"icon-comment"},[a("i",{staticClass:"material-icons"},[t._v("\n              feedback\n              ")])]):t._e()])]})],2)]):t._e(),t._v(" "),t._l(t.metaData,function(e,s){return[t.isDetalheMeta(e)?a("card-expand",{key:s,attrs:{title:e.meta_key}},["object"==typeof e.meta_value?a("ul",{staticClass:"mdl-list lista-dados"},t._l(e.meta_value,function(e,s){return a("li",{key:s,staticClass:"mdl-list__item mdl-list__item--two-line"},[a("span",{staticClass:"mdl-list__item-primary-content"},[a("h6",[t._v(t._s(t.$t(s)))]),t._v(" "),"DATA DO CHAMADO"==s?a("span",{},[t._v("\n                  "+t._s(t._f("formatDataMeta")(e))+"\n              ")]):a("span",[t._v("\n              "+t._s(e)+"\n              ")])])])}),0):a("span",[t._v("\n          "+t._s(e.meta_value)+"\n      ")])]):t._e()]})],2)},staticRenderFns:[]},b=a("VU/8")(g,w,!1,null,null,null).exports,C=a("MF2h"),D=a("gRE1"),$=a.n(D),y={name:"ResponseItem",props:{form:{type:Object,required:!0},response:{type:Object,required:!0}},computed:{descItem:function(){var t=this.form.metaDados.filter(function(t){return"ancora"==t.meta_key});if(t&&1==t.length){var e=this.form.perguntas.filter(function(e){return e.metaDados.filter(function(e){return"ancora"==e.meta_key&&e.meta_value==t[0].meta_value}).length}),a=$()(this.response.responses).filter(function(t){return t.idPergunta==e[0].id});switch(e[0].tipo){case"parts_selection":var s=0;return JSON.parse(a[0].valor).forEach(function(t){s+=t.quantidade}),s+this.$t(" peças selecionadas");default:return a[0].valor?a[0].valor:this.response.data}}var r=this.response.data instanceof Date?this.response.data.toISOString():"object"==_()(this.response.data)?this.response.data:String(this.response.data);return T()(r).format("DD/MM/YYYY")}}},z={render:function(){var t=this.$createElement;return(this._self._c||t)("span",[this._v(this._s(this.descItem))])},staticRenderFns:[]},O=a("VU/8")(y,z,!1,null,null,null).exports,R=a("BeRe"),F={components:{TaskTitle:m.a,TaskDescription:b,MessageButton:C.a,Form:R.default,ResponseItem:O},data:function(){return{blockedDialog:{opened:!1},responses:[],inResponse:!1,formReqCode:null,form:"",currentResponse:null}},methods:{getResponses:function(){var t=this,e=this.currentTask.responses.filter(function(e){return e.idForm==t.form.id});this.responses=e&&e.length>0?JSON.parse(u()(e[0])):null,t.$forceUpdate()},saveFormPecas:function(t){this.blockedDialog.opened=!1,this.$root.cardContent=!1,this.$store.dispatch("task/setResponseCurrentTask",{response:t,index:0})},closeblocked:function(){this.blockedDialog.opened=!1,this.$root.cardContent=!1},openFormDialog:function(){var t=this;t.form?(t.blockedDialog.opened=!0,t.$root.cardContent=!0,t.$forceUpdate()):(this.formReqCode=this.currentTask.metaDados.filter(function(t){return"__FORM_REQ_CODE"==t.meta_key})[0],l.a.getOneFormById(this.formReqCode?parseInt(this.formReqCode.meta_value):21).then(function(e){t.form=e,t.getResponses(),t.blockedDialog.opened=!0,t.$root.cardContent=!0,t.$forceUpdate()}))}},watch:{blockedDialog:{handler:function(t){t.opened?this.$el.querySelector("#dialog-blocked").showModal():this.$el.querySelector("#dialog-blocked").close()},deep:!0}},computed:r()({},Object(k.b)({currentTask:"task/currentTask",user:"user/user"})),mounted:function(){var t=this;setTimeout(function(){t.$dialogPolyfill.doDialog("dialog-blocked")},500)},filters:{}},x={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"task-before bottom-bar-padding"},[a("TaskTitle",{attrs:{task:t.currentTask}}),t._v(" "),a("TaskDescription",{attrs:{task:t.currentTask}}),t._v(" "),t.currentTask?a("dialog",{directives:[{name:"show",rawName:"v-show",value:t.blockedDialog.opened,expression:"blockedDialog.opened"}],staticClass:"mdl-dialog modal-form full",attrs:{id:"dialog-blocked"}},[a("div",{staticClass:"mdl-dialog__content",class:{visible:this.$root.cardContent}},[t.form&&t.form.titulo?a("h5",{staticClass:"mdl-dialog__title"},[t._v(t._s(t.$t(t.form.titulo)))]):t._e(),t._v(" "),t.form?a("Form",{attrs:{idForm:t.form.id,typeForm:"simple",readOnly:"2"==t.user.route.status,readonlyState:"2"==t.user.route.status,value:t.responses},on:{save:t.saveFormPecas,cancel:t.closeblocked}}):t._e(),t._v(" "),"1"!=t.user.route.status?a("div",{staticClass:"form-actions simple"},[a("button",{staticClass:"mdl-button grey",on:{click:t.closeblocked}},[t._v(t._s(t.$t("Cancelar")))])]):t._e()],1)]):t._e(),t._v(" "),a("div",{staticClass:"bottom-bar"},[a("button",{staticClass:"mdl-button mdl-button--raised mdl-button--accent orange whited",on:{click:t.openFormDialog}},[this.currentTask.responses&&0!=this.currentTask.responses.length?t._e():a("i",{staticClass:"material-icons"},[t._v("build")]),t._v(" "),this.currentTask.responses&&0!=this.currentTask.responses.length?a("i",{staticClass:"material-icons green"},[t._v("check")]):t._e(),t._v("\n      "+t._s(t.$t("Requisição de Peças"))+"\n    ")]),t._v(" "),a("div",{staticClass:"actions"},[a("message-button")],1)])],1)},staticRenderFns:[]};var M=a("VU/8")(F,x,!1,function(t){a("nM1/")},"data-v-7b839b90",null).exports,E=a("JjHe"),I={components:{TaskTitle:m.a,TaskDescription:b,MessageButton:C.a},data:function(){return{tasksInProgress:!1}},methods:{changeStatus:function(){this.tasks.travelStarted.length||this.tasks.travelDone.length||this.tasks.iniciada.length?this.$el.querySelector("#dialogConfirmStopTask").showModal():(this.$store.dispatch("task/startTravel"),this.$geolocation.startTravelling())},stopTasksAndStartTravel:function(){var t=this;this.tasks.travelStarted.forEach(function(e){t.$store.dispatch("task/stopTask",{task:e})}),this.tasks.travelDone.forEach(function(e){t.$store.dispatch("task/stopTask",{task:e})}),this.tasks.iniciada.forEach(function(e){t.$store.dispatch("task/stopTask",{task:e})}),this.$store.dispatch("task/startTravel"),this.$geolocation.startTravelling(),this.$el.querySelector("#dialogConfirmStopTask").close()},cancelStopTask:function(){Object(E.c)(this.currentTask.id,"travelStartedFail","travelStartedFail"),this.$el.querySelector("#dialogConfirmStopTask").close()}},computed:r()({},Object(k.b)({currentTask:"task/currentTask",user:"user/user",tasks:"task/tasks"}),{taskInProgress:function(){var t={};this.tasks.travelStarted.length?t=this.tasks.travelStarted[0]:this.tasks.travelDone.length?t=this.tasks.travelDone[0]:this.tasks.iniciada.length&&(t=this.tasks.iniciada[0]);var e=t.nome?t.nome:t.id;if(!t.nome&&t.metaDados)for(var a in t.metaDados)if("__OS"==t.metaDados[a].meta_key)return t.metaDados[a].meta_value;return e}}),mounted:function(){this.$dialogPolyfill.doDialog("dialogConfirmStopTask")},filters:{}},P={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"task-before bottom-bar-padding"},[a("TaskTitle",{attrs:{task:t.currentTask}}),t._v(" "),a("TaskDescription",{attrs:{task:t.currentTask}}),t._v(" "),a("div",{staticClass:"bottom-bar"},[a("button",{staticClass:"mdl-button mdl-button--raised mdl-button--accent orange whited",on:{click:function(e){return t.changeStatus()}}},[a("i",{staticClass:"material-icons"},[t._v("near_me")]),t._v(t._s(t.$t("Iniciar Deslocamento"))+"\n    ")]),t._v(" "),a("div",{staticClass:"actions"},[a("MessageButton")],1)]),t._v(" "),a("dialog",{directives:[{name:"mdl",rawName:"v-mdl"}],staticClass:"mdl-dialog",attrs:{id:"dialogConfirmStopTask"}},[a("h3",{staticClass:"mdl-dialog__title"},[t._v(t._s(t.$t("Existe uma tarefa em andamento, deseja interrompela?")))]),t._v(" "),a("div",{staticClass:"mdl-dialog__content"},[t._v("\n      "+t._s(t.taskInProgress)+"\n    ")]),t._v(" "),a("div",{staticClass:"mdl-dialog__actions"},[a("button",{staticClass:"mdl-button mdl-button--raised mld-button-small mdl-button--colored",on:{click:t.stopTasksAndStartTravel}},[a("span",[t._v(t._s(t.$t("Confirmar")))])]),t._v(" "),a("button",{staticClass:"mdl-button ",on:{click:t.cancelStopTask}},[a("span",[t._v(t._s(t.$t("Cancelar")))])])])])],1)},staticRenderFns:[]},N=a("VU/8")(I,P,!1,null,null,null).exports,j={components:{TaskTitle:m.a,TaskDescription:b,MessageButton:C.a},data:function(){return{}},methods:{changeStatus:function(){var t=this;return c()(i.a.mark(function e(){var a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$routeService.permitirInformarChegadaTarefaAtual(t);case 2:1!=(a=e.sent)?(t.$bus.$emit("showMessageEmitted",{msg:a}),Object(E.c)(t.currentTask.id,a,"info")):(t.$store.dispatch("task/travelDone"),t.$geolocation.stopTravelling(),t.$emit("updateTask"));case 4:case"end":return e.stop()}},e,t)}))()}},computed:r()({},Object(k.b)({currentTask:"task/currentTask",user:"user/user"})),mounted:function(){},filters:{}},B={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"task-before bottom-bar-padding"},[a("TaskTitle",{attrs:{task:t.currentTask}}),t._v(" "),a("TaskDescription",{attrs:{task:t.currentTask}}),t._v(" "),a("div",{staticClass:"bottom-bar"},[t.user&&"1"!=t.user.route.status?a("button",{staticClass:"mdl-button mdl-button--raised mdl-button--accent green whited",on:{click:t.changeStatus}},[a("i",{staticClass:"material-icons"},[t._v("location_on")]),t._v(t._s(t.$t("Informar Chegada"))+"\n      ")]):t._e(),t._v(" "),a("div",{staticClass:"actions"},[a("MessageButton")],1)])],1)},staticRenderFns:[]},V=a("VU/8")(j,B,!1,null,null,null).exports,q={components:{TaskTitle:m.a,TaskDescription:b,MessageButton:C.a},data:function(){return{user:{route:{status:0}}}},methods:{changeStatus:function(){var t=this;return c()(i.a.mark(function e(){var a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$routeService.permitirInformarChegadaTarefaAtual(t);case 2:1!=(a=e.sent)?(t.$bus.$emit("showMessageEmitted",{msg:a}),Object(E.c)(t.currentTask.id,a,"info")):(t.$geolocation.stopTravelling(),t.$store.dispatch("task/startTask"));case 4:case"end":return e.stop()}},e,t)}))()},goToTaskProblem:function(){this.$router.push("/taskProblem/"+this.currentTask.id)}},computed:r()({},Object(k.b)({currentTask:"task/currentTask"})),mounted:function(){},filters:{}},W={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"task-before bottom-bar-padding"},[a("TaskTitle",{attrs:{task:t.currentTask}}),t._v(" "),a("button",{staticClass:"mdl-button button-warning",on:{click:t.goToTaskProblem}},[a("i",{staticClass:"material-icons"},[t._v("warning")]),t._v("\n    "+t._s(t.$t("Consumidor Ausente e/ou Endereço não localizado"))+"\n  ")]),t._v(" "),a("TaskDescription",{attrs:{task:t.currentTask}}),t._v(" "),a("div",{staticClass:"bottom-bar"},["travelDone"==t.currentTask.status&&"1"!=t.user.route.status?a("button",{staticClass:"mdl-button mdl-button--raised mdl-button--accent orange whited",on:{click:function(e){return t.changeStatus("iniciada")}}},[a("i",{staticClass:"material-icons"},[t._v("play_circle_filled")]),t._v(t._s(t.$t("Iniciar Tarefa"))+"\n    ")]):t._e(),t._v(" "),a("div",{staticClass:"actions"},[a("MessageButton")],1)])],1)},staticRenderFns:[]},Y=a("VU/8")(q,W,!1,null,null,null).exports,U={components:{CardExpand:v.a,TaskDescription:b,MessageButton:C.a,Form:R.default},data:function(){return{forms:[],form:"",formDialog:{opened:!1},inResponse:!1,currentResponse:null}},watch:{},methods:{doneTask:function(){var t=this,e=!0;this.currentTask.formsExtra&&this.forms.forEach(function(a){t.getFormMandatory(a)&&0==t.getResponsesCount(a)&&(e=!1)}),e?this.$store.dispatch("task/doneTask",{responses:[]}):this.$bus.$emit("showErrorEmitted",{msg:this.$t("Existem Formulários obrigatórios não respondidos!")})},getForms:function(){var t=this;return c()(i.a.mark(function e(){var a,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.forms=[],e.prev=1,a=JSON.parse(t.currentTask.forms),e.t0=i.a.keys(a);case 4:if((e.t1=e.t0()).done){e.next=13;break}return s=e.t1.value,e.t2=t.forms,e.next=9,l.a.getOneFormById(parseInt(a[s]));case 9:e.t3=e.sent,e.t2.push.call(e.t2,e.t3),e.next=4;break;case 13:e.next=18;break;case 15:e.prev=15,e.t4=e.catch(1),console.log(e.t4);case 18:case"end":return e.stop()}},e,t,[[1,15]])}))()},getResponses:function(t){var e=!1;return this.currentTask.responses&&(e=this.currentTask.responses.filter(function(e){return e.idForm==t.id})),e&&e.length>0?e:[]},getResponsesCount:function(t){return this.getResponses(t).length},getFormMandatory:function(t){if(this.currentTask.formsExtra){var e=JSON.parse(this.currentTask.formsExtra);if(e.obrigatorios)return e.obrigatorios.filter(function(e){return e==t.id}).length>0}},addResponseItem:function(t){this.canEdit()&&(this.openForm(t),this.currentResponse=null,this.inResponse=!0)},editResponseItem:function(t,e){this.openForm(t),this.currentResponse=JSON.parse(u()(e)),this.inResponse=!0},cancelResponseItem:function(){this.closeForm(),this.currentResponse={},this.inResponse=!1,this.form=null},removeResponseItem:function(t,e){this.form=t,this.$store.dispatch("task/removeResponseCurrentTask",{index:this.currentTask.responses.indexOf(e)}),this.inResponse=!1,this.$forceUpdate()},saveResponseItem:function(t){if(this.currentTask.responses){var e=this.currentTask.responses.find(function(e){return e.uuid==t.uuid});if(e){var a=this.currentTask.responses.indexOf(e);this.$store.dispatch("task/setResponseCurrentTask",{response:t,index:a})}else this.$store.dispatch("task/addResponseCurrentTask",{response:t})}else this.$store.dispatch("task/addResponseCurrentTask",{response:t});this.currentResponse={},this.inResponse=!1,this.closeForm()},openForm:function(t){this.form=t,this.formDialog.opened=!0,this.$root.cardContent=!0,this.$el.querySelector("#formDialog").showModal(),this.$forceUpdate()},closeForm:function(){this.formDialog.opened=!1,this.$root.cardContent=!1,this.$el.querySelector("#formDialog").close()},canEdit:function(){return"iniciada"==this.currentTask.status&&"2"!=this.user.route.status}},computed:r()({},Object(k.b)({currentTask:"task/currentTask",tasks:"task/tasks",user:"user/user"}),{formResponses:function(){var t=this;return this.currentTask.responses&&this.form?this.currentTask.responses.filter(function(e){return e.idForm==t.form.id}):null}}),beforeMount:function(){this.getForms()},mounted:function(){var t=this;setTimeout(function(){t.$dialogPolyfill.doDialog("dialog-blocked")},100)},filters:{}},A={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"card-conteudo card-wizard col"},[a("div",{staticClass:"card-content not-padding",class:{visible:this.$root.cardContent},attrs:{id:"card-content"}},[a("div",{staticClass:"bottom-bar-padding"},[a("task-description",{attrs:{task:t.currentTask}}),t._v(" "),t.forms.length>0?a("div",{staticClass:"mdl-card",class:{visible:this.$root.cardContent}},[a("h6",[t._v(t._s(t.$t("Formulários")))]),t._v(" "),t._l(t.forms,function(e,s){return a("div",{key:s,staticClass:"section section-form input-selecao-pecas",attrs:{model:e}},[a("button",{staticClass:"mdl-button mdl-button--raised bgGray button-input",class:{orange:t.getFormMandatory(e)&&0==t.getResponsesCount(e)},attrs:{disabled:!t.canEdit()},on:{click:function(a){return t.addResponseItem(e)}}},[t.canEdit()?a("i",{staticClass:"material-icons"},[t._v("add")]):t._e(),t._v(t._s(e.titulo)+" "),a("span",{directives:[{name:"show",rawName:"v-show",value:t.getFormMandatory(e),expression:"getFormMandatory(form)"}]},[t._v("*")])]),t._v(" "),a("ul",{directives:[{name:"mdl",rawName:"v-mdl"}],staticClass:"mdl-list"},[t._l(t.getResponses(e),function(s,r){return a("li",{key:r,staticClass:"mdl-list__item mdl-list__item"},[a("span",{staticClass:"mdl-list__item-primary-content",on:{click:function(a){return t.editResponseItem(e,s)}}},[a("span",[t._v(t._s(t._f("formatDateTime")(s.data)))])]),t._v(" "),a("span",{staticClass:"mdl-list__item-secondary-content mdl-list__item-secondary-action"},[a("a",{attrs:{href:"#"},on:{click:function(a){return t.editResponseItem(e,s)}}},[t.canEdit()?a("i",{staticClass:"material-icons orange"},[t._v("edit_circle")]):t._e()]),t._v(" "),a("a",{attrs:{href:"#"},on:{click:function(a){return t.removeResponseItem(e,s)}}},[t.canEdit()?a("i",{staticClass:"material-icons"},[t._v("remove_circle")]):t._e()]),t._v(" "),a("a",{attrs:{href:"#"},on:{click:function(a){return t.editResponseItem(e,s)}}},[a("i",{staticClass:"material-icons orange"},[t._v("search")])])])])}),t._v(" "),0==t.getResponsesCount(e)?a("li",{staticClass:"mdl-list__item mdl-list__item"},[a("span",{staticClass:"mdl-list__item-primary-content"},[a("span",[t._v(t._s(t.$t("Nenhuma resposta encontrada!")))])])]):t._e()],2)])})],2):t._e(),t._v(" "),a("dialog",{directives:[{name:"show",rawName:"v-show",value:t.formDialog.opened,expression:"formDialog.opened"}],staticClass:"mdl-dialog modal-form full",attrs:{id:"formDialog"}},[a("div",{staticClass:"mdl-dialog__content",class:{visible:this.$root.cardContent}},[t.form&&t.form.titulo?a("h5",{staticClass:"mdl-dialog__title",class:{notinResponse:t.form&&!t.inResponse}},[t._v(t._s(t.$t(t.form.titulo)))]):t._e(),t._v(" "),t.inResponse?a("div",{staticClass:"inResponse"},[a("Form",{attrs:{idForm:t.form.id,typeForm:"simple",value:t.currentResponse,readOnly:!t.canEdit()},on:{save:t.saveResponseItem,cancel:t.cancelResponseItem}}),t._v(" "),t.canEdit()?t._e():a("div",{staticClass:"form-actions simple"},[a("button",{staticClass:"mdl-button mdl-js-button grey",on:{click:t.cancelResponseItem}},[t._v(t._s(t.$t("Voltar")))])])],1):t._e()])]),t._v(" "),a("dialog",{directives:[{name:"mdl",rawName:"v-mdl"}],staticClass:"mdl-dialog",attrs:{id:"dialogConfirmRemoveItem"}},[a("h6",{staticClass:"mdl-dialog__title"},[t._v(t._s(t.$t("Confirmar exclusão")))]),t._v(" "),a("div",{staticClass:"mdl-dialog__content"},[a("p",[t._v(t._s(t.$t("Deseja realmente remover esta resposta {content} ?",{content:""})))])]),t._v(" "),a("div",{staticClass:"mdl-dialog__actions"},[a("button",{staticClass:"mdl-button orange",attrs:{type:"button"},on:{click:function(e){return t.saveAndCloseDialogMaintenance()}}},[t._v("\n                        "+t._s(t.$t("Ok"))+"\n                    ")]),t._v(" "),a("button",{staticClass:"mdl-button grey close",attrs:{type:"button"},on:{click:function(e){return t.closeDialogMaintenance()}}},[t._v("\n                        "+t._s(t.$t("Cancelar"))+"\n                    ")])])]),t._v(" "),a("div",{staticClass:"bottom-bar"},[t.canEdit()?a("button",{staticClass:"mdl-button mdl-button--raised mdl-button--accent orange whited",on:{click:function(e){return t.doneTask()}}},[a("i",{staticClass:"material-icons"},[t._v("check")]),t._v(t._s(t.$t("Finalizar Tarefa"))+"\n                ")]):t._e(),t._v(" "),t.canEdit()?t._e():a("button",{staticClass:"mdl-button mdl-button--raised mdl-button--accent orange whited",on:{click:function(e){return t.$router.back()}}},[a("i",{staticClass:"material-icons"},[t._v("keyboard_backspace")]),t._v(t._s(t.$t("Voltar"))+"\n                ")]),t._v(" "),a("div",{staticClass:"actions"},[a("message-button")],1)])],1)])])},staticRenderFns:[]};var J=a("VU/8")(U,A,!1,function(t){a("sVJS")},null,null).exports,L=a("llSq"),H=a("DtRx"),Z=a.n(H),G={components:{FormWizard:L.a},data:function(){return{}},watch:{},methods:{wizardSaved:function(t){var e=[];for(var a in t)try{if(t.hasOwnProperty(a)&&t[a].value){var s=t[a].value;s.idForm=t[a].idForm,s.uuid=Z()(),e.push(s)}}catch(t){console.log(t)}this.$store.dispatch("task/doneTask",{responses:e}),window.appState.takingPicture=!1,window.appState.fieldId=null,window.appState.result=!1,window.appState.error=null,window.appState.routeName=null,window.localStorage.setItem("TrackerUP_state",u()(window.appState));var r=this.$store.getters["task/tasks"];if(r&&r.all&&r.all.length&&!r.pendente.length){var n={message:this.$t("As OSs disponíveis para atendimento foram finalizadas!"),route:"task.future",button:this.$t("Ver OS futuras"),duration:5e3};this.$geolocation.stopBackground(this),this.$bus.$emit("showSnackBar",n)}this.$router.push("/tasks")},canEdit:function(){return"iniciada"==this.currentTask.status&&"2"!=this.user.route.status}},computed:r()({},Object(k.b)({currentTask:"task/currentTask",tasks:"task/tasks",user:"user/user"}))},X={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"mdl-card card-conteudo card-wizard col"},[this.currentTask?e("div",{staticClass:"card-content",class:{visible:this.$root.cardContent},attrs:{id:"card-content"}},[e("FormWizard",{attrs:{task:this.currentTask},on:{wizardSaved:this.wizardSaved}})],1):this._e()])},staticRenderFns:[]},Q=a("VU/8")(G,X,!1,null,null,null).exports,K={components:{TaskTitle:m.a,CardExpand:v.a,TaskForm:J,TaskFormWizard:Q},data:function(){return{}},watch:{},methods:{isDetalheMeta:function(t){if(0!=t.meta_key.indexOf("__")){if("string"!=typeof t.meta_value)return"object"!=_()(t.meta_value)||h()(t.meta_value).length>0;if(""!=t.meta_value&&"[]"!=t.meta_value)return!0}return!1}},computed:r()({},Object(k.b)({currentTask:"task/currentTask",tasks:"task/tasks",user:"user/user"}),{numOS:function(){var t=this.currentTask.id;if(this.currentTask.metaDados)for(var e in this.currentTask.metaDados)if("__OS"==this.currentTask.metaDados[e].meta_key)return this.currentTask.metaDados[e].meta_value;return t},tipoOS:function(){if(this.currentTask.metaDados)for(var t in this.currentTask.metaDados)if("OS"==this.currentTask.metaDados[t].meta_key)return"object"==_()(this.currentTask.metaDados[t].meta_value)?this.currentTask.metaDados[t].meta_value["TIPO DE OS"]:JSON.parse(this.currentTask.metaDados[t].meta_value)["TIPO DE OS"];return""},metaData:function(){var t=[];if(this.currentTask.metaDados)for(var e in this.currentTask.metaDados)if(!this.currentTask.metaDados[e].meta_key.startsWith("__"))try{t.push({meta_key:this.currentTask.metaDados[e].meta_key,meta_value:JSON.parse(this.currentTask.metaDados[e].meta_value)})}catch(a){t.push(this.currentTask.metaDados[e])}return t},hasWizzard:function(){if(!this.currentTask.metaDados)return!1;var t=this.currentTask.metaDados.filter(function(t){return"__WIZARD_CODE"==t.meta_key})[0],e=this.currentTask.metaDados.filter(function(t){return"__dados_os"==t.meta_key})[0],a=!1;return void 0!==e&&(a=JSON.parse(e.meta_value).orderId),t&&(e&&a||parseInt(t.meta_value)>0)}}),mounted:function(){this.$emit("changeParams",{pageTitle:this.$t("Em atendimento"),mapMenu:!1,backMenu:!0,routeMap:"/taskMap"})},filters:{formatDataComment:function(t){if(!t)return t;try{return T()(t).format("DD/MM/YYYY HH:mm:ss")}catch(e){return t}}}},tt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"task-started"},[t.$root.dialogOpen?t._e():a("div",{staticClass:"mdl-card expand limited"},[a("h4",[t._v(t._s(t.$t("Nº da OS"))+" "+t._s(t.numOS))]),t._v(" "),a("div",{staticClass:"detalhes-tarefa"},[a("center",[a("small",[t._v(t._s(t.tipoOS))])]),t._v(" "),t.currentTask.historico&&t.currentTask.historico.length?a("card-expand",{key:"historicoOS",attrs:{title:"Comentários"}},[a("ul",{staticClass:"mdl-list lista-dados"},[t._l(t.currentTask.historico,function(e,s){return[a("li",{key:s,staticClass:"mdl-list__item mdl-list__item--two-line"},[a("span",{staticClass:"mdl-list__item-primary-content"},[a("h6",[t._v(t._s(e.mensagem))]),t._v(" "),a("span",[t._v("\n                  "+t._s(t._f("formatDataComment")(e.data))+"\n                ")])])])]})],2)]):t._e(),t._v(" "),t._l(t.metaData,function(e,s){return[t.isDetalheMeta(e)&&"Dados do Cliente"==e.meta_key?a("card-expand",{key:s,attrs:{title:t.$t(e.meta_key)}},["object"==typeof e.meta_value?a("ul",{staticClass:"mdl-list lista-dados"},t._l(e.meta_value,function(e,s){return a("li",{key:s,staticClass:"mdl-list__item mdl-list__item--two-line"},[a("span",{staticClass:"mdl-list__item-primary-content"},[a("h6",[t._v(t._s(t.$t(s)))]),t._v(" "),a("span",{},[t._v("\n                  "+t._s(e)+"\n                ")])])])}),0):t._e()]):t._e()]}),t._v(" "),null!=t.currentTask.comentario&&""!=t.currentTask.comentario?a("card-expand",{attrs:{title:t.$t("Observações")}},[a("div",{staticClass:"lista-dados",domProps:{innerHTML:t._s(t.currentTask.comentario)}})]):t._e()],2)]),t._v(" "),t.hasWizzard?a("task-form-wizard"):a("task-form")],1)},staticRenderFns:[]},et=a("VU/8")(K,tt,!1,null,null,null).exports,at={components:{TaskTitle:m.a,CardExpand:v.a,TaskForm:J,TaskFormWizard:Q,TaskDescription:b,MessageButton:C.a},data:function(){return{}},watch:{},methods:{isDetalheMeta:function(t){if(0!=t.meta_key.indexOf("__")){if("string"!=typeof t.meta_value)return"object"!=_()(t.meta_value)||h()(t.meta_value).length>0;if(""!=t.meta_value&&"[]"!=t.meta_value)return!0}return!1}},computed:r()({},Object(k.b)({currentTask:"task/currentTask",tasks:"task/tasks",user:"user/user"}),{numOS:function(){var t=this.currentTask.id;if(this.currentTask.metaDados)for(var e in this.currentTask.metaDados)if("__OS"==this.currentTask.metaDados[e].meta_key)return this.currentTask.metaDados[e].meta_value;return t},tipoOS:function(){if(this.currentTask.metaDados)for(var t in this.currentTask.metaDados)if("OS"==this.currentTask.metaDados[t].meta_key)return this.currentTask.metaDados[t].meta_value["TIPO DE OS"];return""},metaData:function(){var t=[];if(this.currentTask.metaDados)for(var e in this.currentTask.metaDados)if(!this.currentTask.metaDados[e].meta_key.startsWith("__"))try{t.push({meta_key:this.currentTask.metaDados[e].meta_key,meta_value:JSON.parse(this.currentTask.metaDados[e].meta_value)})}catch(a){t.push(this.currentTask.metaDados[e])}return t},hasWizzard:function(){if(!this.currentTask.metaDados)return!1;var t=this.currentTask.metaDados.filter(function(t){return"__WIZARD_CODE"==t.meta_key})[0],e=this.currentTask.metaDados.filter(function(t){return"__dados_os"==t.meta_key})[0],a=!1;return void 0!==e&&(a=JSON.parse(e.meta_value).orderId),t&&(e&&a||parseInt(t.meta_value)>0)}}),mounted:function(){this.$emit("changeParams",{pageTitle:this.$t("Em atendimento"),mapMenu:!1,backMenu:!0,routeMap:"/taskMap"})},filters:{formatDataComment:function(t){if(!t)return t;try{return T()(t).format("DD/MM/YYYY HH:mm:ss")}catch(e){return t}}}},st={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content-page"},[a("div",{staticClass:"task-started"},[a("div",{staticClass:"mdl-card expand limited"},[a("h4",[t._v(t._s(t.$t("Nº da OS"))+" "+t._s(t.numOS))]),t._v(" "),a("div",{staticClass:"detalhes-tarefa"},[a("center",[a("small",[t._v(t._s(t.tipoOS))])]),t._v(" "),t.currentTask.historico&&t.currentTask.historico.length?a("card-expand",{key:"historicoOS",attrs:{title:"Comentários"}},[a("ul",{staticClass:"mdl-list lista-dados"},[t._l(t.currentTask.historico,function(e,s){return[a("li",{key:s,staticClass:"mdl-list__item mdl-list__item--two-line"},[a("span",{staticClass:"mdl-list__item-primary-content"},[a("h6",[t._v(t._s(e.mensagem))]),t._v(" "),a("span",[t._v("\n                    "+t._s(t._f("formatDataComment")(e.data))+"\n                  ")])])])]})],2)]):t._e(),t._v(" "),t._l(t.metaData,function(e,s){return[t.isDetalheMeta(e)&&"Dados do Cliente"==e.meta_key?a("card-expand",{key:s,attrs:{title:t.$t(e.meta_key)}},["object"==typeof e.meta_value?a("ul",{staticClass:"mdl-list lista-dados"},t._l(e.meta_value,function(e,s){return a("li",{key:s,staticClass:"mdl-list__item mdl-list__item--two-line"},[a("span",{staticClass:"mdl-list__item-primary-content"},[a("h6",[t._v(t._s(t.$t(s)))]),t._v(" "),a("span",{},[t._v("\n                    "+t._s(e)+"\n                  ")])])])}),0):t._e()]):t._e()]}),t._v(" "),null!=t.currentTask.comentario&&""!=t.currentTask.comentario?a("card-expand",{attrs:{title:t.$t("Observações")}},[a("div",{staticClass:"lista-dados",domProps:{innerHTML:t._s(t.currentTask.comentario)}})]):t._e()],2)]),t._v(" "),a("div",{staticClass:"card-conteudo card-wizard col"},[t.hasWizzard?[a("task-description",{attrs:{task:t.currentTask}}),t._v(" "),a("div",{staticClass:"bottom-bar"},[a("button",{staticClass:"mdl-button mdl-button--raised mdl-button--accent orange whited",on:{click:function(e){return t.$router.back()}}},[a("i",{staticClass:"material-icons"},[t._v("keyboard_backspace")]),t._v(t._s(t.$t("Voltar"))+"\n          ")]),t._v(" "),a("div",{staticClass:"actions"},[a("message-button")],1)])]:a("task-form")],2)])])},staticRenderFns:[]},rt=a("VU/8")(at,st,!1,null,null,null).exports,nt={components:{CardExpand:v.a,ViewTaskBloqued:M,ViewTaskPending:N,ViewTaskTravelStarted:V,ViewTaskTravelDone:Y,ViewTaskStarted:et,ViewTaskFinished:rt},data:function(){return{typeForm:"simple",blockedDialog:{opened:!1},blockedDialogOS:{opened:!1},forms:[]}},watch:{currentRoute:function(t){this.checkRoute(t)},blockedDialog:{handler:function(t){t.opened?this.$el.querySelector("#dialog-blocked").showModal():this.$el.querySelector("#dialog-blocked").close()},deep:!0},blockedDialogOS:{handler:function(t){t.opened?this.$el.querySelector("#dialog-blocked-os").showModal():this.$el.querySelector("#dialog-blocked-os").close()},deep:!0},currentTask:function(t){this.$emit("changeParams",{pageTitle:t&&("iniciada"==t.status?this.$t("Em atendimento"):this.$t("Detalhes da tarefa")),mapMenu:t&&"iniciada"!=t.status,backMenu:!0,routeMap:"/taskMap"})}},methods:{changePageParams:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null==t&&(t={pageTitle:this.$t("Detalhes da tarefa"),mapMenu:!0,backMenu:!0,routeMap:"/taskMap/"+this.task.id}),this.$emit("changeParams",t)},setCurrentTask:function(){this.responses=this.currentTask.responses,this.$forceUpdate()},getForms:function(){this.forms=[];try{var t=JSON.parse(this.currentTask.forms);for(var e in t)this.forms.push(l.a.getOneFormById(t[e]))}catch(t){console.log(t)}},exitToList:function(t){if(this&&this.$t){var e={message:this.$t("OS "+this.numOS+" foi excluida"),duration:3e3};this.$bus.$emit("showSnackBar",e),this.$root.dialogOpen=!1,this.$router.back()}},updateTask:function(){}},beforeMount:function(){var t=this;return c()(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.setCurrentTask();case 2:return e.next=4,t.getForms();case 4:case"end":return e.stop()}},e,t)}))()},computed:r()({},Object(k.b)({currentTask:"task/currentTask",tasks:"task/tasks",user:"user/user",coords:"user/coords"}),{numOS:function(){var t=this.task.id;if(this.task.metaDados)for(var e in this.task.metaDados)if("__OS"==this.task.metaDados[e].meta_key)return this.task.metaDados[e].meta_value;return t},periodo:function(){return'{"hora":7,"minuto":0}'==this.task.planedStart?this.$t("Manhã"):this.$t("Tarde")},metaData:function(){var t=[];if(this.task.metaDados)for(var e in this.task.metaDados)if(!this.task.metaDados[e].meta_key.startsWith("__"))try{t.push({meta_key:this.task.metaDados[e].meta_key,meta_value:JSON.parse(this.task.metaDados[e].meta_value)})}catch(a){t.push(this.task.metaDados[e])}return t},taskStarted:function(){return["iniciada"].includes(this.task.status)},response:function(){return this.responses&&this.responses.length>0?this.responses[0]:null}}),mounted:function(){for(var t=this,e=document.getElementsByClassName("expandNow"),a=0;a<e.length;a++){e[a].childNodes[0].childNodes[0].childNodes[2].click()}window.appState.takingPicture||this.$bus.$emit("loading",!1),this.$bus.$on("currentTaskDeleted",this.exitToList),setTimeout(function(){t.$dialogPolyfill.doDialog("dialog-blocked"),t.$dialogPolyfill.doDialog("dialog-blocked-os")},500)},filters:{formatDataMeta:function(t){return t?t.slice(6,8)+"/"+t.slice(4,6)+"/"+t.slice(0,4):t},formatDataComment:function(t){if(!t)return t;try{return T()(t).format("DD/MM/YYYY HH:mm:ss")}catch(e){return t}}},beforeDestroy:function(){this.$refs&&this.$refs.subForm&&(this.$refs.subForm.$destroy(),this.$refs.subForm=null)}},it={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content-page"},[t.currentTask&&"bloqueada"==t.currentTask.status?a("ViewTaskBloqued",{on:{updateTask:t.updateTask}}):t._e(),t._v(" "),!t.currentTask||"pendente"!=t.currentTask.status&&"interrompida"!=t.currentTask.status?t._e():a("ViewTaskPending",{on:{updateTask:t.updateTask}}),t._v(" "),t.currentTask&&"travelStarted"==t.currentTask.status?a("ViewTaskTravelStarted",{on:{updateTask:t.updateTask}}):t._e(),t._v(" "),t.currentTask&&"travelDone"==t.currentTask.status?a("ViewTaskTravelDone",{on:{updateTask:t.updateTask}}):t._e(),t._v(" "),t.currentTask&&"iniciada"==t.currentTask.status?a("ViewTaskStarted",{on:{updateTask:t.updateTask}}):t._e(),t._v(" "),!t.currentTask||"concluida"!=t.currentTask.status&&"malsucedida"!=t.currentTask.status?t._e():a("ViewTaskFinished",{on:{updateTask:t.updateTask}}),t._v(" "),null===t.currentTask?a("div",{staticClass:"task-before"},[a("div",{staticClass:"mdl-card taskitem"},[t._v("\n        "+t._s(t.$t("Aguarde..."))+"\n    ")])]):t._e()],1)},staticRenderFns:[]};var ot=a("VU/8")(nt,it,!1,function(t){a("MWDh")},null,null);e.default=ot.exports},M6Fp:function(t,e,a){"use strict";var s={name:"CardExpand",data:function(){return{expand:!1}},props:{title:{type:String,required:!0,default:""}},methods:{triggerExpand:function(){this.expand=!this.expand}}},r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"mdl-card expand"},[a("h6",{class:{active:t.expand},on:{click:t.triggerExpand}},[t._v(t._s(t.$t(t.title))+"\n    "),t._m(0)]),t._v(" "),a("div",{staticClass:"mdl-grid mdl-grid--no-spacing dados",class:{active:t.expand}},[a("div",{staticClass:"col"},[t._t("default")],2)])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"arrow-button"},[e("i",{staticClass:"material-icons"},[this._v("arrow_drop_down")])])}]},n=a("VU/8")(s,r,!1,null,null,null);e.a=n.exports},MF2h:function(t,e,a){"use strict";var s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("button",{staticClass:"mdl-button mdl-button--fab orange",on:{click:function(e){return t.$router.push("/messages")}}},[a("i",{staticClass:"material-icons message"},[t._v("message")])])},staticRenderFns:[]},r=a("VU/8")({name:"MessageButton"},s,!1,null,null,null);e.a=r.exports},MWDh:function(t,e){},llSq:function(t,e,a){"use strict";var s=a("Dd8w"),r=a.n(s),n=a("pFYg"),i=a.n(n),o=a("woOf"),c=a.n(o),d=a("Xxa5"),u=a.n(d),l=a("W3Iv"),m=a.n(l),f=a("gRE1"),h=a.n(f),p=a("exGp"),_=a.n(p),k=a("BeRe"),v={name:"WizardStep",props:{idForm:{required:!1},value:{required:!1,default:null},title:{type:String,required:!1,default:""},typeForm:{type:String,required:!1,default:"simple"},backDisabled:{type:Boolean,required:!1,default:!1},readOnly:{type:Boolean,required:!1,default:!1},readonlyState:{type:Boolean,required:!1,default:!1}},data:function(){return{values:{data:null,respostas:{}}}},beforeCreate:function(){this.$options.components.Form=a("BeRe").default},methods:{save:function(t){this.values=t,this.$emit("save",this.values)},cancel:function(t){this.values=t,this.$emit("cancel",t)}},components:{Form:k.default},beforeDestroy:function(){this.$refs&&this.$refs.subForm&&(this.$refs.subForm.$destroy(),this.$refs.subForm=null)}},S={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.idForm?a("Form",{ref:"subForm",attrs:{idForm:t.idForm,backDisabled:t.backDisabled,title:t.title,value:t.value,readOnly:t.readOnly,typeForm:t.typeForm,readonlyState:t.readonlyState},on:{save:t.save,input:function(e){t.$emit("input",e)},cancel:t.cancel,updatePreResp:function(e){t.$emit("updatePreResp",e)}}}):t._e()},staticRenderFns:[]},T=a("VU/8")(v,S,!1,null,null,null).exports,g=a("T75j"),w={getOneWizardResponseByIdTarefa:function(t){return g.a.getOne("wizardResponse",t)},setOne:function(t){g.b.setOne("wizardResponse",t)},deleteOne:function(t){this.getOneWizardResponseByIdTarefa(t).then(function(t){t&&t.idTarefa&&g.b.deleteOne("wizardResponse",t.idTarefa)})}},b=a("R4BC"),C=a("T8Nv"),D=a("NYxO"),$={name:"FormWizard",props:{task:{type:Object,required:!0}},data:function(){return{firstState:0,wizardId:1,wizardState:{currentState:null,currentTransition:null,checkPointTransition:null,readonlyState:!0,transitionLog:[],preResp:{},states:{}},transitions:[]}},beforeMount:function(){var t=this;return _()(u.a.mark(function e(){var a,s,r;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=t,t.wizardId=0;try{t.wizardId=parseInt(h()(a.task.metaDados).find(function(t){return"__WIZARD_CODE"==t.meta_key}).meta_value),console.log("WIZARD ID TRUE",t.wizardId)}catch(e){t.wizardId=0,console.log("WIZARD ID ERROR",t.wizardId)}return e.next=5,b.a.getOneFormWizardById(t.wizardId);case 5:return s=e.sent,e.next=8,w.getOneWizardResponseByIdTarefa(t.task.id);case 8:r=e.sent,s&&r&&(0===m()(a.wizardState.states).length&&a.wizardState.states.constructor===Object&&(a.wizardState.states=s.states),a.wizardState.transitions=s.transitions,a.transitions=s.transitions,a.firstState=s.firstState,null!=r.wizardState.currentState&&void 0!==r.wizardState.currentState?a.wizardState.currentState=r.wizardState.currentState:a.wizardState.currentState=h()(s.states).find(function(t){return t.id==s.firstState})),t.loadValues();case 11:case"end":return e.stop()}},e,t)}))()},methods:{loadValues:function(){var t=this;return _()(u.a.mark(function e(){var a,s,r,n,i;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t,e.next=3,w.getOneWizardResponseByIdTarefa(a.task.id);case 3:if(s=e.sent,r=t.task.metaDados.find(function(t){return"__OS"==t.meta_key}),!(s&&r&&r.meta_value)||s.wizardState.preResp.OS!=r.meta_value&&s.wizardState.preResp.nOS!=r.meta_value){e.next=15;break}return a.wizardState=s.wizardState,a.$store.dispatch("task/setDefaultPreResp",{preResp:a.wizardState.preResp}),e.next=10,b.a.getOneFormWizardById(a.wizardId);case 10:(n=e.sent)&&(0===m()(a.wizardState.states).length&&a.wizardState.states.constructor===Object&&(a.wizardState.states=n.states),a.firstState=n.firstState,null!=s.wizardState.currentState&&void 0!==s.wizardState.currentState?a.wizardState.currentState=s.wizardState.currentState:a.wizardState.currentState=h()(n.states).find(function(t){return t.id==n.firstState}),a.transitions=n.transitions),"wizardsave"==a.wizardState.currentState.type&&a.saveWizardResponses(a.wizardState.states),e.next=31;break;case 15:if(r&&s&&r.meta_value&&s.wizardState.preResp&&(s.wizardState.preResp.OS!=r.meta_value||s.wizardState.preResp.nOS!=r.meta_value)&&w.deleteOne(a.task.id),e.prev=16,i=JSON.parse(h()(a.task.metaDados).find(function(t){return"__pre_resp"==t.meta_key}).meta_value),a.wizardState.preResp=i,!(!a.wizardState.preResp||a.wizardState.preResp.OS&&a.wizardState.preResp.OS!=r.meta_value||a.wizardState.preResp.nOS&&a.wizardState.preResp.OS!=r.meta_value)){e.next=21;break}throw new Error("oops");case 21:a.$store.dispatch("task/setDefaultPreResp",{preResp:i}),e.next=28;break;case 24:e.prev=24,e.t0=e.catch(16),a.$bus.$emit("showSnackBar",{message:a.$t("OS ainda em sincronização!"),duration:3e3}),Object(C.e)(a.task.id).then(function(t){a.$bus.$emit("tasks-sync",!0),a.wizardState.preResp=t.data,a.$store.dispatch("task/setDefaultPreResp",{preResp:t.data})});case 28:return e.next=30,w.setOne({idTarefa:a.task.id,wizardState:a.wizardState});case 30:a.loadValues();case 31:case"end":return e.stop()}},e,t,[[16,24]])}))()},setState:function(t){var e=this;this.wizardState.currentTransition=t,this.wizardState.transitionLog.push(t),null==h()(e.wizardState.states).find(function(t){return t.id==e.wizardState.currentState.id}).value&&c()(h()(e.wizardState.states).find(function(t){return t.id==e.wizardState.currentState.id}),this.wizardState.currentState),this.wizardState.currentState=h()(e.wizardState.states).find(function(e){return e.id==t.destiny}),this.$bus.$emit("changeParams",{pageTitle:this.$t("Em atendimento"),mapMenu:!1,backMenu:this.wizardState.firstState==this.wizardState.currentState.id}),w.setOne({idTarefa:this.task.id,wizardState:this.wizardState}),"wizardsave"==this.wizardState.currentState.type&&this.saveWizardResponses(this.wizardState.states),"wizardconfirm"==this.wizardState.currentState.type&&this.orderStatesByTransition()},updateForm:function(t){if(this.wizardState.currentState.value=t,void 0!==this.wizardState.transitionLog.slice(-1)[0]){var e=this.wizardState.transitionLog.slice(-1)[0].destiny;h()(this.wizardState.states).find(function(t){return t.id==e}).value=t}w.setOne({idTarefa:this.task.id,wizardState:this.wizardState})},updatePreResp:function(t){this.defaultPreResp&&(this.$store.dispatch("task/updateDefaultPreResp",t),this.wizardState.preResp=this.defaultPreResp,w.setOne({idTarefa:this.task.id,wizardState:this.wizardState}))},saveForm:function(t){var e=this;for(var a in e.wizardState.currentState.value=t,h()(e.wizardState.states).find(function(t){return t.id==e.wizardState.currentState.id}).value=t,e.destinys){var s=e.destinys[a];if(null==s.value||""==s.value)return void this.setState(s);if(null!=s.field&&"object"==i()(s.field)){if(h()(e.wizardState.states).find(function(t){return t.id==s.field.state}).value.responses[s.field.id].valor==s.value)return void this.setState(s)}else if(t.responses[s.field].valor==s.value)return void this.setState(s)}Object(C.e)(this.task.id).then(function(t){e.$bus.$emit("tasks-sync",!0),e.$store.dispatch("task/setDefaultPreResp",{preResp:t.data})}),e.$bus.$emit("showSnackBar",{message:e.$t("Formulário não possui valores válidos!"),duration:3e3})},aproveForm:function(){for(var t in this.destinys){this.wizardState.checkPointTransition=this.destinys[t],this.setState(this.wizardState.checkPointTransition);break}},cancelForm:function(t){var e=this;this.updateForm(t),null==this.wizardState.currentTransition||null!=this.wizardState.checkPointTransition&&this.wizardState.currentTransition.id==this.wizardState.checkPointTransition.id||(this.wizardState.currentTransition=this.wizardState.transitionLog.pop(),null!=this.wizardState.currentTransition&&(this.wizardState.currentState=h()(e.wizardState.states).find(function(t){return t.id==e.wizardState.currentTransition.origin})))},editForm:function(){var t=this;for(t.wizardState.currentTransition=t.wizardState.transitionLog.pop();null!=t.wizardState.currentTransition&&t.wizardState.transitionLog.length>0&&(null==t.wizardState.checkPointTransition||t.wizardState.currentTransition.id!=t.wizardState.checkPointTransition.id);)t.wizardState.currentTransition=t.wizardState.transitionLog.pop();null!=t.wizardState.currentTransition&&(0==t.wizardState.transitionLog.length?(t.wizardState.currentTransition=null,t.wizardState.currentState=h()(t.wizardState.states).find(function(e){return e.id==t.firstState}),t.$bus.$emit("changeParams",{pageTitle:t.$t("Em atendimento"),mapMenu:!1,backMenu:t.firstState==t.wizardState.currentState.id})):t.setState(t.wizardState.currentTransition))},renderForm:function(t){return("wizardsave"!=t.type||this.wizardState.currentState.id!=t.id)&&(null!=t.id&&t.id==this.wizardState.currentState.id||"wizardconfirm"==this.wizardState.currentState.type&&null!=t.value&&""!=t.value)},saveWizardResponses:function(t){this.$emit("wizardSaved",t)},orderStatesByTransition:function(){var t=this;if(t.wizardState.transitionLog&&t.wizardState.transitionLog.length>0){console.log("PRE ORDENACAO",t.wizardState.states);var e=[],a=[];t.wizardState.transitionLog.forEach(function(s){("object"!=i()(t.wizardState.states)?t.wizardState.states:h()(t.wizardState.states)).forEach(function(t){s.origin==t.id?e.push(t):-1===a.indexOf(t)&&a.push(t)})}),a.forEach(function(t){-1===e.indexOf(t)&&e.push(t)}),t.wizardState.states=e,console.log("POS ORDENACAO",t.wizardState.states)}}},computed:r()({},Object(D.b)({currentTask:"task/currentTask",defaultPreResp:"task/defaultPreResp"}),{destinys:function(){var t=[];for(var e in this.transitions){var a=this.transitions[e];a.origin==this.wizardState.currentState.id&&t.push(a)}return t},backDisabled:function(){return this.firstState==this.wizardState.currentState.id||null!=this.wizardState.transitionLog&&null!=this.wizardState.checkPointTransition&&this.wizardState.transitionLog[this.wizardState.transitionLog.length-1].id==this.wizardState.checkPointTransition.id}}),components:{WizardStep:T}},y={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.wizardState&&t.wizardState.currentState?a("div",{staticClass:"col"},[t._l(t.wizardState.states,function(e,s){return a("span",{key:s},[t.renderForm(e)?a("WizardStep",{attrs:{idForm:e.idForm,backDisabled:t.backDisabled,title:e.title,value:e.value,readOnly:t.wizardState.currentState&&"wizardconfirm"==t.wizardState.currentState.type,typeForm:e.type,readonlyState:t.wizardState.readonlyState},on:{save:t.saveForm,input:t.updateForm,cancel:t.cancelForm,updatePreResp:t.updatePreResp}}):t._e()],1)}),t._v(" "),t.wizardState.currentState&&"wizardsave"==t.wizardState.currentState.type?a("div",{staticClass:"form-actions wizardconfirm"},[t._v("\n    "+t._s(t.$t("Salvando dados.."))+"\n  ")]):t._e(),t._v(" "),t.wizardState.currentState&&"wizardconfirm"==t.wizardState.currentState.type?a("div",{staticClass:"form-actions wizardconfirm"},[a("button",{staticClass:"mdl-button  button-edit",on:{click:t.editForm}},[a("i",{staticClass:"material-icons"},[t._v("close")]),t._v(t._s(t.$t("Alterar"))+"\n    ")]),t._v(" "),a("button",{staticClass:"mdl-button  button-confirm ",on:{click:t.aproveForm}},[t._v(t._s(t.$t("Aprovar"))),a("i",{staticClass:"material-icons"},[t._v("check_circle_outline")])])]):t._e()],2):t._e()},staticRenderFns:[]},z=a("VU/8")($,y,!1,null,null,null);e.a=z.exports},"nM1/":function(t,e){},sVJS:function(t,e){},tJgT:function(t,e,a){"use strict";var s=a("fZjL"),r=a.n(s),n=a("pFYg"),i=a.n(n),o=a("Dd8w"),c=a.n(o),d=a("NYxO"),u=a("M6Fp"),l=a("PJh5"),m=a.n(l),f={name:"TaskTitle",components:{CardExpand:u.a},props:{task:{type:Object,required:!0,default:function(){return{id:0,title:"",status:"",address:""}}}},mounted:function(){for(var t=document.getElementsByClassName("expandNow"),e=0;e<t.length;e++){t[e].childNodes[0].childNodes[0].childNodes[2].click()}},computed:c()({},Object(d.b)({currentTask:"task/currentTask"}),{numOS:function(){var t=this.task.id;if(this.task.metaDados)for(var e in this.task.metaDados)if("__OS"==this.task.metaDados[e].meta_key)return this.task.metaDados[e].meta_value;return t}}),methods:{isDetalheMeta:function(t){if(0!=t.meta_key.indexOf("__")){if("string"!=typeof t.meta_value)return"object"!=i()(t.meta_value)||r()(t.meta_value).length>0;if(""!=t.meta_value&&"[]"!=t.meta_value)return!0}return!1}},filters:{formatDataMeta:function(t){return t?t.slice(6,8)+"/"+t.slice(4,6)+"/"+t.slice(0,4):t},formatDataComment:function(t){if(!t)return t;try{return m()(t).format("DD/MM/YYYY HH:mm:ss")}catch(e){return t}}}},h={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"mdl-card taskitem"},[a("div",{staticClass:"row row-titulo"},[a("div",{staticClass:"status-title"},[a("div",{staticClass:"status"},[t._v(t._s(t._f("capitalize")(t.$t(t.currentTask.status))))]),t._v(" "),a("div",{staticClass:"title"},[t._v(t._s(t.$t("Nº da OS"))+" "+t._s(t.numOS))])])]),t._v(" "),a("div",{staticClass:"row"},[t._m(0),t._v(" "),a("div",{staticClass:"address"},[t._v("\n      "+t._s(t.currentTask.endereco)+"\n    ")])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"location-icon"},[e("i",{staticClass:"material-icons"},[this._v("location_on")])])}]},p=a("VU/8")(f,h,!1,null,null,null);e.a=p.exports}});
//# sourceMappingURL=2.0aef5f13c7a983088ada.js.map